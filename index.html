<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="theme-color" content="#0f172a" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title> Ch√∫c b√© h·ªçc gi·ªèi !!! </title>
<style>
 :root{
   --bg:#0f172a;--card:#111827;--pri:#22d3ee;--ok:#22c55e;--bad:#ef4444;--text:#e5e7eb;--muted:#9ca3af;

   /* Cute panda background (embedded SVG data URI) */
   --panda-bg: url("data:image/svg+xml;utf8, \
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'> \
  <defs> \
    <linearGradient id='g' x1='0' y1='0' x2='0' y2='1'> \
      <stop offset='0%' stop-color='%23e6f5ea'/> \
      <stop offset='100%' stop-color='%23d8f0e2'/> \
    </linearGradient> \
  </defs> \
  <rect width='100%' height='100%' fill='url(%23g)'/> \
  <!-- soft leaves --> \
  <g fill='%2395c7a5' opacity='0.18'> \
    <path d='M40 50 l20 -6 l-12 18 z'/> \
    <path d='M520 70 l22 -6 l-12 18 z'/> \
    <path d='M120 320 l24 -8 l-10 20 z'/> \
  </g> \
  <!-- cute panda centered --> \
  <g transform='translate(300 200)'> \
    <!-- body shadow --> \
    <ellipse cx='0' cy='110' rx='160' ry='60' fill='%23000000' opacity='0.06'/> \
    <!-- body --> \
    <ellipse cx='0' cy='70' rx='120' ry='80' fill='%23ffffff'/> \
    <!-- ears --> \
    <ellipse cx='-72' cy='-34' rx='32' ry='36' fill='%23222'/> \
    <ellipse cx='72' cy='-34' rx='32' ry='36' fill='%23222'/> \
    <!-- eye patches --> \
    <ellipse cx='-45' cy='-10' rx='34' ry='38' fill='%23222'/> \
    <ellipse cx='45' cy='-10' rx='34' ry='38' fill='%23222'/> \
    <!-- eyes glint --> \
    <circle cx='-45' cy='-6' r='10' fill='%23ffffff'/> \
    <circle cx='45' cy='-6' r='10' fill='%23ffffff'/> \
    <circle cx='-50' cy='-4' r='4' fill='%23000'/> \
    <circle cx='40' cy='-4' r='4' fill='%23000'/> \
    <!-- nose & mouth --> \
    <ellipse cx='0' cy='10' rx='10' ry='8' fill='%23000'/> \
    <path d='M -12 22 Q 0 32 12 22' stroke='%23000' stroke-width='3' stroke-linecap='round' fill='none'/> \
    <!-- blush --> \
    <circle cx='-28' cy='18' r='12' fill='%23ffb6c1' opacity='0.9'/> \
    <circle cx='28' cy='18' r='12' fill='%23ffb6c1' opacity='0.9'/> \
    <!-- little paw --> \
    <ellipse cx='-90' cy='80' rx='22' ry='14' fill='%23222' opacity='0.9'/> \
    <ellipse cx='90' cy='80' rx='22' ry='14' fill='%23222' opacity='0.9'/> \
  </g> \
</svg>");
 }
 *{box-sizing:border-box;-webkit-tap-highlight-color: transparent}
 html, body{height:100%;}
 body{
   margin:0;
   font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif;
   /* Fallback gradient + Panda background image (cover/center/no-repeat) */
   background:
     linear-gradient(120deg,#0f172a,#0b1023);
   color:var(--text);
   min-height:100dvh;
   position:relative; /* for overlay pseudo element */
 }
 /* ===== Background image layer (behind everything, does not affect layout) ===== */
 body::before{
   content:"";
   position:fixed; inset:0; z-index:0;
   background-image: var(--panda-bg);
   background-size: cover;         /* cover as requested */
   background-position: center;    /* center as requested */
   background-repeat: no-repeat;   /* no-repeat as requested */
   opacity: 0.95;                  /* keep it soft */
   pointer-events:none;            /* never block interactions */
 }
 /* ===== Soft overlay to guarantee readability (stays above bg, below app) ===== */
 body::after{
   content:"";
   position:fixed; inset:0; z-index:0;
   background: rgba(255,255,255,0.55); /* gentle white veil to improve contrast */
   pointer-events:none;
 }

 header{padding:16px 12px;text-align:center;position:sticky;top:0;background:linear-gradient(120deg,#0f172a,#0b1023);z-index:10}
 header h1{margin:0;font-size:clamp(18px,4.5vw,26px)}
 .wrap{max-width:1100px;margin:0 auto;padding:10px 12px 84px; position:relative; z-index:1;} /* ensure above overlay */
 /* Sticky bottom nav for mobile */
 nav{position:fixed;left:0;right:0;bottom:0;background:#0b1220cc;backdrop-filter:blur(6px);display:flex;gap:8px;flex-wrap:nowrap;overflow-x:auto;padding:10px 12px;border-top:1px solid #334155;z-index:20}
 nav::-webkit-scrollbar{display:none}
 button,select,label.switch{white-space:nowrap}
 button,select{background:var(--card);color:var(--text);border:1px solid #334155;border-radius:12px;padding:12px 14px;cursor:pointer;font-size:16px}
 button:active{transform:scale(0.98)}
 .pill{border-radius:999px}
 .card{background:radial-gradient(1200px 600px at -10% -30%,#1f2937,transparent),var(--card);border:1px solid #334155;border-radius:16px;padding:14px;margin-bottom:12px; position:relative; z-index:1;}
 .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
 .hidden{display:none}
 .score{font-weight:700}
 .tag{font-size:12px;color:var(--muted)}
 .k{font-size:clamp(18px,5vw,24px)}
 .v{color:#94a3b8}
 .mcq-option{padding:14px;border:1px solid #334155;border-radius:14px;background:#0b1220;cursor:pointer;display:flex;align-items:center;gap:10px;min-height:56px}
 .mcq-option .img{font-size:22px}
 .mcq-option.correct{border-color:var(--ok);background:#052915}
 .mcq-option.wrong{border-color:var(--bad);background:#290909}
 .disable-pointer{pointer-events:none;}
 .shake{animation:shake .3s}
 @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
 .match-wrap{display:grid;grid-template-columns:1fr 1fr;gap:10px}
 .col{display:flex;flex-direction:column;gap:8px}
 .tile{padding:14px;border:1px solid #334155;border-radius:14px;background:#0b1220;cursor:pointer;display:flex;align-items:center;gap:10px;min-height:56px}
 .tile .img{font-size:22px}
 .tile.selected{outline:2px solid #22c55e; background:#052915}
 .tile.correct{border-color:var(--ok);background:#052915}
 .tile.wrong{border-color:var(--bad);background:#290909}
 #centerOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:9999}
 #centerBox{background:#0b1220;border:1px solid #334155;border-radius:16px;padding:16px 22px;font-size:clamp(18px,5vw,28px);text-align:center}
 .switch{display:inline-flex;align-items:center;gap:8px}
 @media (prefers-reduced-motion: reduce){*{scroll-behavior:auto} #centerOverlay{transition:none}}
 /* Mobile: keep 2 columns for match mode (CSS-only change) */
 @media (max-width:640px){
   .grid{grid-template-columns:1fr}
   .match-wrap{grid-template-columns:1fr 1fr}
   .wrap{padding-bottom:100px}
 }
 /* Thu nh·ªè k√≠ch th∆∞·ªõc selector nh√≥m t·ª´ v·ª±ng (kh√¥ng ƒë·ªïi layout) */
 #groupSelect{padding:8px 12px;font-size:14px;width:auto;max-width:120px;}

 /* ===== Marquee Animation Styles ===== */
 :root{
   --marquee-speed: 15s; /* Desktop speed */
   --marquee-color-duration: 6s;
 }
 
 header{
   padding: 16px 12px !important;
   text-align: center !important;
   position: sticky !important;
   top: 0 !important;
   background: linear-gradient(120deg, #0f172a, #0b1023) !important;
   z-index: 10 !important;
   overflow: hidden;
 }
 
 .marquee-container{
   width: 100%;
   overflow: hidden;
   display: flex;
   align-items: center;
   justify-content: center;
 }
 
 .marquee-wrapper{
   display: inline-block;
   white-space: nowrap;
   animation: marquee var(--marquee-speed) linear infinite;
 }
 
 header h1{
   margin: 0 !important;
   font-size: clamp(18px, 4.5vw, 26px);
   font-weight: 600;
   white-space: nowrap;
   display: inline-block;
   background: linear-gradient(90deg, 
     #ffffff 0%, 
     #7ee8f7 25%, 
     #ff99cc 50%, 
     #ffffff 100%);
   background-size: 200% 100%;
   animation: colorShift var(--marquee-color-duration) ease-in-out infinite;
   -webkit-background-clip: text;
   background-clip: text;
   -webkit-text-fill-color: transparent;
   padding: 0;
 }
 
 @keyframes marquee{
   0%{
     transform: translateX(100%);
   }
   100%{
     transform: translateX(-100%);
   }
 }
 
 @keyframes colorShift{
   0%{
     background-position: 0% 0%;
   }
   50%{
     background-position: 100% 0%;
   }
   100%{
     background-position: 0% 0%;
   }
 }
 
 /* Mobile: slower marquee speed */
 @media (max-width:768px){
   :root{
     --marquee-speed: 20s; /* Slower on mobile */
   }
 }
</style>
</head>
<body>
<header>
  <div class="marquee-container">
    <div class="marquee-wrapper">
      <h1>Anh y√™u em   Anh y√™u em   Anh y√™u em   </h1>
    </div>
  </div>
</header>
<div class="wrap">
  <section id="flash" class="card">
    <h2>Flashcards</h2>
    <!-- th√™m tabindex ƒë·ªÉ c√≥ th·ªÉ focus b·∫±ng b√†n ph√≠m -->
    <div id="flashCard" class="card" style="text-align:center;cursor:pointer" tabindex="0" role="button" aria-pressed="false">
      <div class="k" id="flashFront"></div>
      <div class="v" id="flashBack" style="margin-top:8px"></div>
      <div class="tag">Ch·∫°m ƒë·ªÉ l·∫≠t / vu·ªët ‚óÄ ‚ñ∂ ƒë·ªÉ chuy·ªÉn</div>
    </div>

    <!-- Flash navigation: Back / Next (mobile + desktop friendly) -->
    <div class="flash-controls" style="display:flex;gap:8px;justify-content:center;margin-top:10px;">
      <button id="flashPrev" onclick="flashPrev()" class="pill" aria-label="Quay l·∫°i t·ª´ tr∆∞·ªõc">‚óÄ Back</button>
      <button id="flashNext" onclick="flashNext()" class="pill" aria-label="Ti·∫øp theo t·ª´">Next ‚ñ∂</button>
    </div>
  </section>

  <section id="mcq" class="card hidden">
    <h2>Tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn</h2>
    <div id="mcqQ" class="k"></div>
    <div id="mcqOptions" class="grid" style="margin-top:10px"></div>
  </section>

  <section id="match" class="card hidden">
    <h2>N·ªëi c·∫∑p ƒë√∫ng</h2>
    <div class="match-wrap">
      <div class="col" id="matchLeft"></div>
      <div class="col" id="matchRight"></div>
    </div>
  </section>

  <section id="spell" class="card hidden">
    <h2>Ch√≠nh t·∫£</h2>
    <div id="spellQ" class="k"></div>
    <input id="spellIn" type="text" placeholder="Nh·∫≠p ƒë√°p √°n..." style="width:100%;margin:8px 0;padding:14px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:var(--text);font-size:18px" />
    <button onclick="checkSpell()">Ki·ªÉm tra</button>
    <div id="spellTip" class="tag"></div>
  </section>
</div>

<nav>
  <button class="pill" onclick="switchMode('flash')">üîÅ Flash</button>
  <button class="pill" onclick="switchMode('mcq')">üß† Tr·∫Øc nghi·ªám</button>
  <button class="pill" onclick="switchMode('match')">üß© N·ªëi c·∫∑p</button>
  <button class="pill" onclick="switchMode('spell')">‚úçÔ∏è Ch√≠nh t·∫£</button>

  <!-- Group selector (added; minimal change; same style) -->
  <select id="groupSelect" onchange="switchGroup(this.value)" title="Ch·ªçn nh√≥m t·ª´ v·ª±ng"></select>

  <select id="langDir" onchange="resetGame()">
    <option value="kr2vi">H√†n ‚ûú Vi·ªát</option>
    <option value="vi2kr">Vi·ªát ‚ûú H√†n</option>
  </select>

  <label class="switch">
    <input type="checkbox" id="imgToggle" checked onchange="render()" /> Emoji VN
  </label>
  <button onclick="shuffleAll()">üîÄ Tr·ªôn</button>
  <span class="score">ƒêi·ªÉm: <span id="score">0</span></span>
</nav>

<div id="centerOverlay"><div id="centerBox"></div></div>

<script>
// ====== GROUPS & DATA ======
const GROUPS = {
  "Nh√≥m T·ª´": [
    {"kr": "ÎßõÏûàÎã§", "vi": "ngon"},
    {"kr": "ÎßõÏóÜÎã§", "vi": "kh√¥ng ngon"},
    {"kr": "Îã¨Îã§", "vi": "ng·ªçt"},
    {"kr": "ÏßúÎã§", "vi": "m·∫∑n"},
    {"kr": "Ïß≠Ïß§ÌïòÎã§", "vi": "h∆°i m·∫∑n"},
    {"kr": "ÏãúÎã§", "vi": "chua"},
    {"kr": "ÎßµÎã§", "vi": "cay"},
    {"kr": "Ïì∞Îã§", "vi": "ƒë·∫Øng"},
    {"kr": "Ïã±Í≤ÅÎã§", "vi": "nh·∫°t"},
    {"kr": "Ïã†ÏÑ†ÌïòÎã§", "vi": "t∆∞∆°i"},
    {"kr": "Î∂ÄÎìúÎüΩÎã§", "vi": "m·ªÅm"},
    {"kr": "ÎäêÎÅºÌïòÎã§", "vi": "b√©o ng·∫≠y (nhi·ªÅu d·∫ßu m·ª°)"},
    {"kr": "Îã¥Î∞±ÌïòÎã§", "vi": "thanh ƒë·∫°m"}
  ],

  "50 T·ª™ V√ôNG DI·ªÑN T·∫¢ T√åNH HU·ªêNG S·∫º X·∫¢Y RA TRONG B·∫æP": [
    {"kr":"ÏîªÎã§","vi":"R·ª≠a"},
    {"kr":"Ìï¥ÎèôÌïòÎã§","vi":"R√£ ƒë√¥ng"},
    {"kr":"ÏñëÌååÎ•º ÏûêÎ•¥Îã§","vi":"C·∫Øt h√†nh"},
    {"kr":"ÎßàÎäòÏùÑ ÍπåÎã§","vi":"B√≥c t·ªèi"},
    {"kr":"ÍπÄÏπòÎ•º Ïç∞Îã§","vi":"Th√°i nh·ªè kimchi"},
    {"kr":"Ï±ÑÏÜåÎ•º ÏîªÎã§","vi":"R·ª≠a rau"},
    {"kr":"ÏñëÎÖêÏùÑ Ï§ÄÎπÑÌïòÎã§","vi":"Chu·∫©n b·ªã gia v·ªã"},
    {"kr":"Ïû¨Î£åÎ•º Ïû¨Îã§","vi":"C√¢n nguy√™n li·ªáu"},
    {"kr":"Í∞êÏûêÎ•º ÍπéÎã§","vi":"G·ªçt khoai t√¢y"},
    {"kr":"ÏüÅÎ∞òÏóê Ïò¨Î¶¨Îã§","vi":"X·∫øp rau v√†o khay"},
    {"kr":"Í≥ÑÎûÄÏùÑ Î∂ÄÏπòÎã§","vi":"Chi√™n tr·ª©ng"},
    {"kr":"Ï±ÑÏÜåÎ•º Î≥∂Îã§","vi":"X√†o rau"},
    {"kr":"Î©¥ÏùÑ ÏÇ∂Îã§","vi":"Lu·ªôc m√¨"},
    {"kr":"Í≥†Í∏∞Î•º ÎÅìÏù¥Îã§","vi":"H·∫ßm th·ªãt"},
    {"kr":"ÏÜåÍ∏àÏùÑ ÎÑ£Îã§","vi":"N√™m mu·ªëi"},
    {"kr":"Í∏∞Î¶ÑÏùÑ ÎëêÎ•¥Îã§","vi":"Cho d·∫ßu ƒÉn"},
    {"kr":"Ïûò Ï†ÄÏñ¥ Ï£ºÎã§","vi":"ƒê·∫£o ƒë·ªÅu"},
    {"kr":"Î¨ºÏùÑ Î∂ìÎã§","vi":"Th√™m n∆∞·ªõc"},
    {"kr":"ÏÉùÏÑ†ÏùÑ ÍµΩÎã§","vi":"N∆∞·ªõng c√°"},
    {"kr":"ÎßåÎëêÎ•º Ï∞åÎã§","vi":"H·∫•p b√°nh bao"},
    {"kr":"Í∑∏Î¶áÏùÑ Í∞ÄÏ†∏Ïò§Îã§","vi":"L·∫•y b√°t"},
    {"kr":"ÏàòÏ†Ä Ï§ÄÎπÑÌïòÎã§","vi":"L·∫•y th√¨a ƒë≈©a"},
    {"kr":"Ï†ëÏãúÏóê Îã¥Îã§","vi":"S·∫Øp x·∫øp th·ª©c ƒÉn l√™n ƒëƒ©a"},
    {"kr":"ÏàòÎüâÏùÑ ÌôïÏù∏ÌïòÎã§","vi":"Ki·ªÉm tra s·ªë l∆∞·ª£ng"},
    {"kr":"ÏùåÏãùÏùÑ Ïû•ÏãùÌïòÎã§","vi":"Trang tr√≠ m√≥n ƒÉn"},
    {"kr":"Ï£ºÎ∞© Ï∞ΩÍµ¨Ïóê Ïò¨Î¶¨Îã§","vi":"ƒê·∫∑t m√≥n ra c·ª≠a b·∫øp"},
    {"kr":"ÏÑúÎ≤ÑÏßÅÏõêÏóêÍ≤å Î∂ÄÎ•¥Îã§","vi":"G·ªçi ph·ª•c v·ª• ƒë·∫øn l·∫•y"},
    {"kr":"Ïû¨Î£åÍ∞Ä Îã§ Îñ®Ïñ¥Ï°åÎã§","vi":"B√°o h·∫øt nguy√™n li·ªáu"},
    {"kr":"ÎßõÏùÑ Î≥¥Îã§","vi":"Th·ª≠ v·ªã"},
    {"kr":"Ïò®ÎèÑÎ•º ÌôïÏù∏ÌïòÎã§","vi":"Ki·ªÉm tra nhi·ªát ƒë·ªô"},
    {"kr":"ÏÑ§Í±∞ÏßÄÎ•º ÌïòÎã§","vi":"R·ª≠a b√°t"},
    {"kr":"ÌÖåÏù¥Î∏îÏùÑ Îã¶Îã§","vi":"Lau b√†n"},
    {"kr":"Î∞îÎã•ÏùÑ Îã¶Îã§","vi":"Lau s√†n"},
    {"kr":"Ïì∞Î†àÍ∏∞Î•º Î≤ÑÎ¶¨Îã§","vi":"ƒê·ªï r√°c"},
    {"kr":"ÌñâÏ£ºÎ•º Í∞ÄÏ†∏Ïò§Îã§","vi":"ƒêem khƒÉn lau"},
    {"kr":"ÎÉÑÏÉàÎ•º ÏóÜÏï†Îã§","vi":"Kh·ª≠ m√πi"},
    {"kr":"ÏπºÏùÑ Ï†ïÎ¶¨ÌïòÎã§","vi":"C·∫•t dao k√©o"},
    {"kr":"ÏñëÎÖêÏùÑ Ï†ïÎ¶¨ÌïòÎã§","vi":"C·∫•t gia v·ªã"},
    {"kr":"Í∞ÄÏä§Î•º Îã¶Îã§","vi":"Lau b·∫øp ga"},
    {"kr":"ÎÉâÏû•Í≥†Î•º Ï†ïÎ¶¨ÌïòÎã§","vi":"D·ªçn t·ªß l·∫°nh"},
    {"kr":"Í∏∞Î¶ÑÏù¥ ÏèüÏïÑÏ°åÎã§","vi":"B·ªã ƒë·ªï d·∫ßu"},
    {"kr":"Î∂àÏù¥ ÎÇ¨Îã§","vi":"B·ªã ch√°y"},
    {"kr":"ÏÜêÏùÑ Î≤†ÏòÄÎã§","vi":"C·∫Øt v√†o tay"},
    {"kr":"Î¨ºÏù¥ ÎÑòÏ≥§Îã§","vi":"N∆∞·ªõc s√¥i tr√†o ra"},
    {"kr":"Íµ≠Ïù¥ ÏèüÏïÑÏ°åÎã§","vi":"ƒê·ªï canh"},
    {"kr":"Í∑∏Î¶áÏù¥ Íπ®Ï°åÎã§","vi":"L√†m v·ª° b√°t"},
    {"kr":"ÌôîÏÉÅÏùÑ ÏûÖÏóàÎã§","vi":"B·ªã b·ªèng"},
    {"kr":"Ïù∏ÏõêÏù¥ Î∂ÄÏ°±ÌïòÎã§","vi":"Thi·∫øu nh√¢n vi√™n"},
    {"kr":"ÌôòÌíçÍ∏∞Í∞Ä Í≥†Ïû•ÎÇ¨Îã§","vi":"M√°y h√∫t m√πi h·ªèng"},
    {"kr":"ÏÜêÎãòÏù¥ Îπ®Î¶¨ Îã¨ÎùºÍ≥† ÌïòÎã§","vi":"Kh√°ch g·ªçi m√≥n g·∫•p"}
  ],

  ". T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ gia v·ªã n·∫•u ƒÉn (1)": [
    {"kr":"ÏÑ§ÌÉï","vi":"ƒê∆∞·ªùng"},
    {"kr":"ÏÜåÍ∏à","vi":"Mu·ªëi"},
    {"kr":"ÎØ∏Ïõê, ÌôîÌïôÏ°∞ÎØ∏Î£å","vi":"B·ªôt ng·ªçt, m√¨ ch√≠nh"},
    {"kr":"Í≥†Ï∂ßÍ∞ÄÎ£®","vi":"·ªöt b·ªôt"},
    {"kr":"ÌõÑÏ∂î","vi":"Ti√™u"},
    {"kr":"ÏãùÏ¥à","vi":"Gi·∫•m"},
    {"kr":"ÌîºÏãúÏÜåÏä§, ÌîºÏâ¨ÏÜåÏä§","vi":"N∆∞·ªõc m·∫Øm"},
    {"kr":"Í∞ÑÏû•","vi":"N∆∞·ªõc t∆∞∆°ng"},
    {"kr":"ÏãùÏö©Ïú†","vi":"D·∫ßu ƒÉn"},
    {"kr":"Íµ¥ÏÜåÏä§","vi":"D·∫ßu h√†o"},
    {"kr":"Ï∞∏Í∏∞Î¶Ñ","vi":"D·∫ßu m√®"},
    {"kr":"Í≥†Ï∂îÏû•","vi":"T∆∞∆°ng ·ªõt"},
    {"kr":"ÎêúÏû•","vi":"T∆∞∆°ng ƒë·∫≠u"},
    {"kr":"Î∂ÄÏπòÎã§","vi":"Chi√™n, r√°n"},
    {"kr":"ÌäÄÍ∏∞Îã§","vi":"Chi√™n (ng·∫≠p d·∫ßu)"},
    {"kr":"Î≥∂Îã§","vi":"X√†o"},
    {"kr":"ÏÇ∂Îã§","vi":"Lu·ªôc"},
    {"kr":"Ï∞åÎã§","vi":"H·∫•p"},
    {"kr":"ÍµΩÎã§","vi":"N∆∞·ªõng"},
    {"kr":"ÎÅìÏù¥Îã§","vi":"ƒêun s√¥i, n·∫•u"},
    {"kr":"Îç∞ÏπòÎã§","vi":"Tr·ª•ng, tr·∫ßn"},
    {"kr":"Ï°∏Ïù¥Îã§","vi":"Ninh, h·∫ßm"},
    {"kr":"ÏûêÎ•¥Îã§","vi":"C·∫Øt"},
    {"kr":"Ïç∞Îã§","vi":"Th√°i s·ª£i, c·∫Øt l√°t"},
    {"kr":"Îã§ÏßÄÎã§","vi":"Gi√£ b·∫±m, bƒÉm nh·ªè"},
    {"kr":"Ïã∏Îã§","vi":"G√≥i, cu·ªën"},
    {"kr":"ÎÑ£Îã§","vi":"B·ªè v√†o"},
    {"kr":"ÎπÑÎπÑÎã§","vi":"Tr·ªôn, qu·∫•y"},
    {"kr":"ÎßõÏùÑ Î≥¥Îã§","vi":"N√™m n·∫øm"}
  ],

  "ƒë·∫°o c·ª• b·∫øp (1)": [
    {"kr":"Ïπº, ÏãùÏπº","vi":"Dao"},
    {"kr":"ÏàüÍ∞ÄÎùΩ","vi":"Mu·ªóng, th√¨a"},
    {"kr":"Ìè¨ÌÅ¨","vi":"Nƒ©a"},
    {"kr":"ÏßëÍ≤å","vi":"K·∫πp (g·∫Øp ƒë·ªì ƒÉn)"},
    {"kr":"Íµ≠Ïûê","vi":"Mu√¥i, v√° (m√∫c canh)"},
    {"kr":"Îí§ÏßëÍ∞ú","vi":"X·∫ªng (n·∫•u ƒÉn)"},
    {"kr":"Í∑∏Î¶á","vi":"T√¥"},
    {"kr":"Î∞•Í∑∏Î¶á","vi":"Ch√©n, b√°t c∆°m"},
    {"kr":"Ï†ëÏãú","vi":"ƒêƒ©a"},
    {"kr":"Ïªµ","vi":"C·ªëc, ly"},
    {"kr":"Ïú†Î¶¨Ïûî","vi":"C·ªëc, ly th·ªßy tinh"},
    {"kr":"ÎèÑÎßà","vi":"Th·ªõt"},
    {"kr":"Ï£ºÍ±±","vi":"V√° m√∫c c∆°m"},
    {"kr":"ÎöúÍªë","vi":"N·∫Øp"},
    {"kr":"Ï†ÑÍ∏∞Î∞•ÏÜ•","vi":"N·ªìi c∆°m ƒëi·ªán"},
    {"kr":"ÎåÄÏïº","vi":"Thau, ch·∫≠u"},
    {"kr":"ÏÜåÏø†Î¶¨","vi":"R·ªï tre"},
    {"kr":"ÎÉÑÎπÑ","vi":"N·ªìi, xoong"},
    {"kr":"ÌîÑÎùºÏù¥Ìå¨","vi":"Ch·∫£o"},
    {"kr":"Ïò§Î∏ê","vi":"L√≤ n∆∞·ªõng"},
    {"kr":"Ï†ÑÏûêÎ†àÏù∏ÏßÄ","vi":"L√≤ vi s√≥ng"},
    {"kr":"ÎÉâÏû•Í≥†","vi":"T·ªß l·∫°nh"},
    {"kr":"ÎÇúÎ°ú","vi":"B·∫øp l√≤"},
    {"kr":"ÏãùÌÉÅ","vi":"B√†n ƒÉn"},
    {"kr":"ÏãùÍ∏∞ÏÑ∏Ï≤ôÍ∏∞","vi":"M√°y r·ª≠a ch√©n"},
    {"kr":"ÎØπÏÑúÍ∏∞","vi":"M√°y xay sinh t·ªë"},
    {"kr":"Ï¶ôÏÑúÍ∏∞","vi":"M√°y √©p"}
  ],

  ". T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ gia v·ªã n·∫•u ƒÉn": [
    {"kr":"ÏÑ§ÌÉï","vi":"ƒê∆∞·ªùng"},
    {"kr":"ÏÜåÍ∏à","vi":"Mu·ªëi"},
    {"kr":"ÎØ∏Ïõê, ÌôîÌïôÏ°∞ÎØ∏Î£å","vi":"B·ªôt ng·ªçt, m√¨ ch√≠nh"},
    {"kr":"Í≥†Ï∂ßÍ∞ÄÎ£®","vi":"·ªöt b·ªôt"},
    {"kr":"ÌõÑÏ∂î","vi":"Ti√™u"},
    {"kr":"ÏãùÏ¥à","vi":"Gi·∫•m"},
    {"kr":"ÌîºÏãúÏÜåÏä§, ÌîºÏâ¨ÏÜåÏä§","vi":"N∆∞·ªõc m·∫Øm"},
    {"kr":"Í∞ÑÏû•","vi":"N∆∞·ªõc t∆∞∆°ng"},
    {"kr":"ÏãùÏö©Ïú†","vi":"D·∫ßu ƒÉn"},
    {"kr":"Íµ¥ÏÜåÏä§","vi":"D·∫ßu h√†o"},
    {"kr":"Ï∞∏Í∏∞Î¶Ñ","vi":"D·∫ßu m√®"},
    {"kr":"Í≥†Ï∂îÏû•","vi":"T∆∞∆°ng ·ªõt"},
    {"kr":"ÎêúÏû•","vi":"T∆∞∆°ng ƒë·∫≠u"},
    {"kr":"Î∂ÄÏπòÎã§","vi":"Chi√™n, r√°n"},
    {"kr":"ÌäÄÍ∏∞Îã§","vi":"Chi√™n (ng·∫≠p d·∫ßu)"},
    {"kr":"Î≥∂Îã§","vi":"X√†o"},
    {"kr":"ÏÇ∂Îã§","vi":"Lu·ªôc"},
    {"kr":"Ï∞åÎã§","vi":"H·∫•p"},
    {"kr":"ÍµΩÎã§","vi":"N∆∞·ªõng"},
    {"kr":"ÎÅìÏù¥Îã§","vi":"ƒêun s√¥i, n·∫•u"},
    {"kr":"Îç∞ÏπòÎã§","vi":"Tr·ª•ng, tr·∫ßn"},
    {"kr":"Ï°∏Ïù¥Îã§","vi":"Ninh, h·∫ßm"},
    {"kr":"ÏûêÎ•¥Îã§","vi":"C·∫Øt"},
    {"kr":"Ïç∞Îã§","vi":"Th√°i"},
    {"kr":"Îã§ÏßÄÎã§","vi":"BƒÉm nh·ªè"},
    {"kr":"Ïã∏Îã§","vi":"G√≥i"},
    {"kr":"ÎÑ£Îã§","vi":"Th√™m"},
    {"kr":"ÎπÑÎπÑÎã§","vi":"Tr·ªôn"},
    {"kr":"ÎßõÏùÑ Î≥¥Îã§","vi":"N√™m n·∫øm"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ nh√† b·∫øp.docx3": [
    {"kr":"ÏÜåÍ≥†Í∏∞","vi":"th·ªãt b√≤"},
    {"kr":"ÎèºÏßÄÍ≥†Í∏∞","vi":"th·ªãt l·ª£n"},
    {"kr":"Ïò§Î¶¨Í≥†Í∏∞","vi":"th·ªãt v·ªãt"},
    {"kr":"Îã≠Í≥†Í∏∞","vi":"th·ªãt g√†"},
    {"kr":"Îã≠Í∞ÄÏä¥ÏÇ¥","vi":"·ª©c g√†"},
    {"kr":"Îã≠ÎÇ†Í∞ú","vi":"c√°nh g√†"},
    {"kr":"Îã≠Îã§Î¶¨","vi":"ƒë√πi g√†"},
    {"kr":"Ïû•Ïñ¥","vi":"l∆∞∆°n"},
    {"kr":"ÏÉùÏÑ†","vi":"c√°"},
    {"kr":"Í≤å","vi":"cua"},
    {"kr":"ÏÉàÏö∞","vi":"t√¥m"},
    {"kr":"Íº¨Îßâ","vi":"s√≤ huy·∫øt"},
    {"kr":"Ïû¨Ï≤©","vi":"h·∫øn"},
    {"kr":"Ï†ÑÎ≥µ","vi":"b√†o ng∆∞"},
    {"kr":"Ïò§ÏßïÏñ¥","vi":"m·ª±c"},
    {"kr":"Îã¨Í±Ä","vi":"tr·ª©ng"},
    {"kr":"ÎëêÎ∂Ä","vi":"ƒë·∫≠u ph·ª•"},
    {"kr":"ÏñëÌåå","vi":"h√†nh t√¢y"},
    {"kr":"ÎåÄÌåå","vi":"h√†nh baro"},
    {"kr":"ÏàôÏ£ºÎÇòÎ¨º","vi":"gi√° ƒë·ªó"},
    {"kr":"ÍπÄÏπò","vi":"kim chi"},
    {"kr":"Í≥µÏã¨Ï±Ñ","vi":"rau mu·ªëng"},
    {"kr":"Î∞∞Ï∂î","vi":"c·∫£i th·∫£o"},
    {"kr":"Î≥ëÌíÄ","vi":"rau m√°"},
    {"kr":"Î≤ÑÏÑØ","vi":"n·∫•m"},
    {"kr":"ÌíÄÎ≤ÑÏÑØ / Ïû£Î≤ÑÏÑØ","vi":"n·∫•m r∆°m"},
    {"kr":"Í∞êÏûê","vi":"khoai t√¢y"},
    {"kr":"ÎãπÍ∑º","vi":"c√† r·ªët"},
    {"kr":"Ïò§Ïù¥","vi":"d∆∞a leo, d∆∞a chu·ªôt"},
    {"kr":"ÌÜ†ÎßàÌÜ†","vi":"c√† chua"},
    {"kr":"ÏàòÏÑ∏ÎØ∏","vi":"m∆∞·ªõp"},
    {"kr":"Í≥†Íµ¨Îßà","vi":"khoai lang"},
    {"kr":"Ìò∏Î∞ï","vi":"b√≠ ng√¥"},
    {"kr":"Ïï†Ìò∏Î∞ï","vi":"b√≠ ng√≤i"},
    {"kr":"Î†àÎ™¨","vi":"chanh"},
    {"kr":"ÎïÖÏΩ©","vi":"ƒë·∫≠u ph·ªông, l·∫°c"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ nh√† b·∫øp.docx 2": [
    {"kr":"ÎÉÑÎπÑ","vi":"n·ªìi, xoong"},
    {"kr":"ÌîÑÎùºÏù¥Ìå¨","vi":"ch·∫£o"},
    {"kr":"Ï†ÑÍ∏∞Î∞•ÏÜ•","vi":"n·ªìi c∆°m ƒëi·ªán"},
    {"kr":"Ïò§Î∏ê","vi":"l√≤ n∆∞·ªõng"},
    {"kr":"ÏïïÎ†•ÏÜ•","vi":"n·ªìi √°p su·∫•t"},
    {"kr":"Í∞ÄÏä§Î†àÏù∏ÏßÄ","vi":"b·∫øp gas"},
    {"kr":"Ï†ÑÍ∏∞Î†àÏù∏ÏßÄ","vi":"b·∫øp t·ª´"},
    {"kr":"ÏãùÌÉÅ","vi":"b√†n ƒÉn"},
    {"kr":"ÎÉâÏû•Í≥†","vi":"t·ªß l·∫°nh"},
    {"kr":"Ï∞¨Ïû•","vi":"t·ªß b·∫øp, t·ªß ƒë·ª±ng ch√©n b√°t"},
    {"kr":"Ïπº","vi":"dao"},
    {"kr":"Í∞ÄÏúÑ","vi":"k√©o"},
    {"kr":"Ï†ëÏãú","vi":"ƒëƒ©a"},
    {"kr":"Í∑∏Î¶á","vi":"t√¥, ch√©n, b√°t"},
    {"kr":"ÏàòÏ†Ä","vi":"th√¨a v√† ƒë≈©a"},
    {"kr":"ÏàüÍ∞ÄÎùΩ","vi":"th√¨a (mu·ªóng)"},
    {"kr":"Ï†ìÍ∞ÄÎùΩ","vi":"ƒë≈©a"},
    {"kr":"Ìè¨ÌÅ¨","vi":"nƒ©a"},
    {"kr":"Ïªµ","vi":"c·ªëc, ly"},
    {"kr":"Ïú†Î¶¨Ïûî","vi":"c·ªëc, ly th·ªßy tinh"},
    {"kr":"Î∞îÍ∞ÄÏßÄ","vi":"c√°i g√°o"},
    {"kr":"ÏÜåÏø†Î¶¨","vi":"c√°i r·ªï"},
    {"kr":"Íµ≠Ïûê","vi":"c√°i mu√¥i, c√°i v√°"},
    {"kr":"Î∂àÌåê","vi":"v·ªâ n∆∞·ªõng"},
    {"kr":"ÏüÅÎ∞ò","vi":"khay, m√¢m"},
    {"kr":"ÏïûÏπòÎßà","vi":"t·∫°p d·ªÅ"},
    {"kr":"ÎÉÖÌÇ®","vi":"khƒÉn ƒÉn, gi·∫•y ƒÉn"},
    {"kr":"Ïù¥Ïë§ÏãúÍ∞ú","vi":"tƒÉm"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ nh√† b·∫øp": [
    {"kr":"Î≥∂Îã§","vi":"chi√™n, x√†o s·ª≠ d·ª•ng √≠t d·∫ßu (chi√™n c∆°m, x√†o rau,‚Ä¶)"},
    {"kr":"ÌäÄÍ∏∞Îã§","vi":"chi√™n ng·∫≠p d·∫ßu"},
    {"kr":"ÍµΩÎã§","vi":"n∆∞·ªõng"},
    {"kr":"ÎÅìÏù¥Îã§","vi":"n·∫•u s√¥i, ƒëun s√¥i"},
    {"kr":"Ï∞åÎã§","vi":"ch∆∞ng, h·∫•p"},
    {"kr":"ÏÇ∂Îã§","vi":"lu·ªôc"},
    {"kr":"Îç∞ÏπòÎã§","vi":"tr·ª•ng, lu·ªôc s∆°"},
    {"kr":"Í∞ÄÏó¥ÌïòÎã§","vi":"ƒëun n√≥ng, h√¢m n√≥ng"},
    {"kr":"Ìï¥ÎèôÌïòÎã§","vi":"r√£ ƒë√¥ng"},
    {"kr":"Í∞àÎã§","vi":"nghi·ªÅn, xay"},
    {"kr":"Ï∞ßÎã§","vi":"gi√£"},
    {"kr":"ÏûêÎ•¥Îã§","vi":"c·∫Øt"},
    {"kr":"Î∞òÏúºÎ°ú ÏûêÎ•¥Îã§","vi":"c·∫Øt l√†m ƒë√¥i"},
    {"kr":"ÎÑ§ Ï°∞Í∞ÅÏúºÎ°ú ÏûêÎ•¥Îã§","vi":"c·∫Øt l√†m t∆∞"},
    {"kr":"ÍπçÎëëÏç∞Í∏∞","vi":"c·∫Øt h·∫°t l·ª±u"},
    {"kr":"Ïç∞Îã§","vi":"th√°i"},
    {"kr":"Ï∞¢Îã§","vi":"x√©, b·ªï, t√°ch"},
    {"kr":"Îã§ÏßÄÎã§","vi":"bƒÉm nh·ªè"},
    {"kr":"Î≤óÍ∏∞Îã§","vi":"b√≥c, t√°ch, l·ªôt (l·ªõp v·ªè m·ªÅm b√™n ngo√†i)"},
    {"kr":"ÍπåÎã§","vi":"b√≥c, t√°ch, l·ªôt (l·ªõp v·ªè t∆∞∆°ng ƒë·ªëi c·ª©ng b√™n ngo√†i)"},
    {"kr":"ÏßúÎÇ¥Îã§","vi":"√©p, v·∫Øt n∆∞·ªõc"},
    {"kr":"Ï†ìÎã§","vi":"qu·∫•y, khu·∫•y"},
    {"kr":"ÎÑ£Îã§","vi":"cho v√†o, th√™m v√†o"},
    {"kr":"Îã¥Í∑∏Îã§","vi":"ng√¢m, mu·ªëi, ·ªß"},
    {"kr":"Î∞úÎùºÎÇ¥Îã§","vi":"g·ª°, r√≥c"},
    {"kr":"ÎºàÎ•º Î∞úÎùºÎÇ¥Îã§","vi":"r√∫t x∆∞∆°ng"},
    {"kr":"ÏåÄÏùÑ ÏîªÎã§","vi":"vo g·∫°o"},
    {"kr":"Í≥†Í∏∞Î•º Íº¨Ï±ôÏù¥Ïóê ÍΩÇÎã§","vi":"x√¢u th·ªãt v√†o xi√™n"},
    {"kr":"Íµ≠Ïóê ÎßõÏùÑ ÎÇ¥Îã§","vi":"n√™m gia v·ªã v√†o canh"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ mi√™u t·∫£.docx4": [
    {"kr":"ÎßõÏûàÎã§","vi":"ngon"},
    {"kr":"ÎßõÏóÜÎã§","vi":"kh√¥ng ngon"},
    {"kr":"Îã¨Îã§","vi":"ng·ªçt"},
    {"kr":"ÏßúÎã§","vi":"m·∫∑n"},
    {"kr":"Ïß≠Ïß§ÌïòÎã§","vi":"h∆°i m·∫∑n"},
    {"kr":"ÏãúÎã§","vi":"chua"},
    {"kr":"ÎßµÎã§","vi":"cay"},
    {"kr":"Ïì∞Îã§","vi":"ƒë·∫Øng"},
    {"kr":"Ïã±Í≤ÅÎã§","vi":"nh·∫°t"},
    {"kr":"Ïã†ÏÑ†ÌïòÎã§","vi":"t∆∞∆°i"},
    {"kr":"Î∂ÄÎìúÎüΩÎã§","vi":"m·ªÅm"},
    {"kr":"ÎäêÎÅºÌïòÎã§","vi":"b√©o ng·∫≠y (nhi·ªÅu d·∫ßu m·ª°)"},
    {"kr":"Îã¥Î∞±ÌïòÎã§","vi":"thanh ƒë·∫°m"}
  ]
};

let currentGroup="Nh√≥m T·ª´";
let DATA = GROUPS[currentGroup];

// ====== EMOJI MAPPING for Vietnamese terms ======
const EMOJI_MAP = {
  /* tastes / feelings */
  "ngon":"ü§§","kh√¥ng ngon":"üòñ","ng·ªçt":"üç¨","m·∫∑n":"üßÇ","h∆°i m·∫∑n":"üßÇ","chua":"üçã","cay":"üå∂Ô∏è","ƒë·∫Øng":"‚òï","nh·∫°t":"üíß","t∆∞∆°i":"ü•ó","m·ªÅm":"üßà","b√©o ng·∫≠y":"üßÄ","thanh ƒë·∫°m":"ü´ñ",

  /* actions / kitchen verbs */
  "r·ª≠a":"üßº","r√£ ƒë√¥ng":"‚ùÑÔ∏è","c·∫Øt":"üî™","c·∫Øt h√†nh":"üî™üßÖ","b√≥c t·ªèi":"üßÑ","th√°i":"üî™","r·ª≠a rau":"ü•¨","chu·∫©n b·ªã gia v·ªã":"üßÇ","c√¢n":"‚öñÔ∏è","g·ªçt":"üî™","x·∫øp":"üì•",
  "chi√™n":"üç≥","x√†o":"üç≥","lu·ªôc":"üç≤","h·∫ßm":"üçñ","n√™m":"üßÇ","d·∫ßu":"üõ¢Ô∏è","n∆∞·ªõng":"üî•","h·∫•p":"ü•ü","l·∫•y b√°t":"üçΩÔ∏è","l·∫•y th√¨a":"ü•Ñ","l·∫•y ƒë≈©a":"ü•¢","s·∫Øp x·∫øp":"üçΩÔ∏è",
  "trang tr√≠":"üåø","g·ªçi ph·ª•c v·ª•":"üì£","th·ª≠ v·ªã":"üëÖ","r·ª≠a b√°t":"üßΩ","lau":"üßπ","ƒë·ªï r√°c":"üóëÔ∏è","khƒÉn":"üßª","kh·ª≠ m√πi":"üß¥","c·∫•t":"üì¶","lau b·∫øp":"üßΩ",
  "d·ªçn t·ªß l·∫°nh":"üßä","b·ªã ƒë·ªï d·∫ßu":"ü´ó","b·ªã ch√°y":"üî•","c·∫Øt v√†o tay":"ü§ï","n∆∞·ªõc s√¥i tr√†o":"üí¶","ƒë·ªï canh":"üçµ","l√†m v·ª° b√°t":"üí•","b·ªã b·ªèng":"ü§ï","thi·∫øu nh√¢n vi√™n":"üë•",
  "m√°y h√∫t m√πi h·ªèng":"üîß","kh√°ch g·ªçi m√≥n g·∫•p":"‚è∞",

  /* condiments / seasoning */
  "ƒë∆∞·ªùng":"üç¨","mu·ªëi":"üßÇ","b·ªôt ng·ªçt":"üßÇ","·ªõt b·ªôt":"üå∂Ô∏è","ti√™u":"üßÇ","gi·∫•m":"ü´ô","n∆∞·ªõc m·∫Øm":"ü•´","n∆∞·ªõc t∆∞∆°ng":"ü•´","d·∫ßu ƒÉn":"üõ¢Ô∏è","d·∫ßu m√®":"üå∞","t∆∞∆°ng ·ªõt":"üå∂Ô∏è","t∆∞∆°ng ƒë·∫≠u":"ü•£",

  /* proteins & seafood */
  "th·ªãt":"ü•©","th·ªãt b√≤":"ü•©","th·ªãt l·ª£n":"ü•ì","th·ªãt v·ªãt":"ü¶Ü","th·ªãt g√†":"üçó","c√°":"üêü","t√¥m":"üç§","cua":"ü¶Ä","m·ª±c":"ü¶ë","l∆∞∆°n":"üêç","h·∫øn":"üêö","s√≤":"üêö","b√†o ng∆∞":"üêö","tr·ª©ng":"ü•ö","ƒë·∫≠u ph·ª•":"üßà",

  /* vegetables & fruits */
  "rau":"ü•¨","rau mu·ªëng":"ü•¨","c·∫£i th·∫£o":"ü•¨","n·∫•m":"üçÑ","khoai t√¢y":"ü•î","khoai lang":"üç†","c√† r·ªët":"ü•ï","d∆∞a leo":"ü•í","c√† chua":"üçÖ","chanh":"üçã","h√†nh":"üßÖ","t·ªèi":"üßÑ","kim chi":"ü•¨",

  /* staples & carbs */
  "m√¨":"üçú","m√¨ ƒÉn li·ªÅn":"üçú","c∆°m":"üçö","b√°nh":"ü•ü","b√°nh bao":"ü•ü","vo g·∫°o":"üçö","g·∫°o":"üçö",

  /* utensils & appliances */
  "dao":"üî™","ch·∫£o":"üç≥","n·ªìi":"ü•ò","l√≤ n∆∞·ªõng":"üî•","l√≤ vi s√≥ng":"üìª","t·ªß l·∫°nh":"üßä","th·ªõt":"üî™","mu·ªóng":"ü•Ñ","th√¨a":"ü•Ñ","ƒë≈©a":"ü•¢","dƒ©a":"üç¥","b√°t":"üçΩÔ∏è","ƒëƒ©a":"üçΩÔ∏è","khay":"üß∫","t·∫°p d·ªÅ":"üßë‚Äçüç≥","m√°y xay":"üîå","m√°y r·ª≠a ch√©n":"üßº",

  /* misc */
  "n∆∞·ªõc":"üíß","tr√†":"üçµ","r∆∞·ª£u":"üç∂","ƒë·ªì ng·ªçt":"üç∞"
};

// heuristic fallback keywords (single words)
const FALLBACK_KEYWORDS = [
  ["th·ªãt","ü•©"],["rau","ü•¨"],["c√°","üêü"],["t√¥m","üç§"],["b√°nh","ü•ü"],["c∆°m","üçö"],["m√¨","üçú"],
  ["dao","üî™"],["ch·∫£o","üç≥"],["n·ªìi","ü•ò"],["t·ªß l·∫°nh","üßä"],["mu·ªëi","üßÇ"],["ƒë∆∞·ªùng","üç¨"],["·ªõt","üå∂Ô∏è"],
  ["tr·ª©ng","ü•ö"],["n·∫•m","üçÑ"],["khoai","ü•î"],["c√† r·ªët","ü•ï"],["c√† chua","üçÖ"],["h√†nh","üßÖ"],["t·ªèi","üßÑ"]
];

// ====== STATE ======
let order=DATA.map((_,i)=>i);
let idx=0, score=0, mode='flash', langDir='kr2vi';
let selectedLeft=null; // for match
let mcqState=null; // persist options until correct

// ====== UTIL ======
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function isVI(text){return /[√†√°·∫£√£·∫°ƒÉ·∫±·∫Ø·∫≥·∫µ·∫∑√¢·∫ß·∫•·∫©·∫´·∫≠√™·ªÅ·∫ø·ªÉ·ªÖ·ªá√¨√≠·ªâƒ©·ªã√≤√≥·ªè√µ·ªç√¥·ªì·ªë·ªï·ªó·ªô∆°·ªù·ªõ·ªü·ª°·ª£√π√∫·ªß≈©·ª•∆∞·ª´·ª©·ª≠·ªØ·ª±·ª≥√Ω·ª∑·ªπ·ªµƒë]/i.test(text)}

// emojiForVI: t√¨m emoji ph√π h·ª£p d·ª±a tr√™n EMOJI_MAP -> FALLBACK_KEYWORDS
function emojiForVI(text){
  if(!document.getElementById('imgToggle')?.checked) return '';
  if(!text) return '';
  const t = text.toString().toLowerCase();
  // exact or phrase match from EMOJI_MAP
  for(const k of Object.keys(EMOJI_MAP)){
    if(t.includes(k)) return EMOJI_MAP[k];
  }
  // fallback by keywords
  for(const [kw,emo] of FALLBACK_KEYWORDS){
    if(t.includes(kw)) return emo;
  }
  // last resort: simple food emoji if contains common food letters
  if(/\b(c∆°m|m√¨|b√°nh|b√≤|g√†|c√°|t√¥m|rau|tr·ª©ng)\b/.test(t)) return 'üçΩÔ∏è';
  return '';
}

function showCenter(msg){const ov=document.getElementById('centerOverlay'); const box=document.getElementById('centerBox'); box.textContent=msg; ov.style.display='flex'; setTimeout(()=>{ov.style.display='none'}, 900)}
function shuffleAll(){if(DATA.length===0){showCenter('Nh√≥m r·ªóng ‚Äî kh√¥ng th·ªÉ tr·ªôn'); return;} shuffle(order); idx=0; mcqState=null; render(); showCenter('ƒê√£ tr·ªôn b·ªô t·ª´!')}
function switchMode(m){document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));document.getElementById(m).classList.remove('hidden');mode=m; if(m==='match') setupMatch(true); if(m==='mcq') mcqState=null; render(); window.scrollTo({top:0, behavior:'smooth'});}
function resetGame(){langDir=document.getElementById('langDir').value;idx=0; mcqState=null; if(mode==='match') setupMatch(true); render()}
function currentPair(){return DATA[order[idx]]}
function render(){document.getElementById('score').textContent=score; if(mode==='flash') renderFlash(); if(mode==='mcq') renderMCQ(); if(mode==='match') renderMatch(); if(mode==='spell') renderSpell();}

/* ====== FLASH ====== */
function renderFlash(){
  const f=document.getElementById('flashFront');
  const b=document.getElementById('flashBack');
  const card=document.getElementById('flashCard');

  if(!DATA || DATA.length===0){
    f.textContent = 'Nh√≥m r·ªóng';
    b.textContent = 'Vui l√≤ng ch·ªçn nh√≥m kh√°c';
    card.onclick = null;
    card.onkeydown = null;
    return;
  }

  const p=currentPair();
  const front= langDir==='kr2vi'? `${p.kr}` : `${p.vi}`;
  const backText = langDir==='kr2vi'? `${p.vi}` : p.kr;
  const backEmoji = langDir==='kr2vi'? emojiForVI(p.vi) : '';
  f.textContent=front;
  b.textContent='(ch·∫°m ƒë·ªÉ xem)';

  function doFlip(){
    // flip shows back with optional emoji (safe)
    b.textContent = backEmoji ? (backEmoji + ' ' + backText) : backText;
  }
  card.onclick = doFlip;

  card.onkeydown = (e)=>{
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      doFlip();
    }else if(e.key === 'ArrowRight'){
      idx = (idx+1) % DATA.length; renderFlash();
    }else if(e.key === 'ArrowLeft'){
      idx = (idx-1 + DATA.length) % DATA.length; renderFlash();
    }
  };
}

// ====== TOUCH SWIPE FOR FLASH ======
let touchStartX=null;
document.addEventListener('touchstart',e=>{touchStartX=e.changedTouches[0].screenX},{passive:true});
document.addEventListener('touchend',e=>{if(touchStartX==null) return; let dx=e.changedTouches[0].screenX - touchStartX; if(Math.abs(dx)>50){ idx=(idx + (dx<0?1:-1) + (DATA.length||1))%(DATA.length||1); renderFlash(); } touchStartX=null;},{passive:true});

// Add Next / Back handlers (used by buttons and can be called programmatically)
function flashPrev(){
  if(!DATA || DATA.length===0) return;
  idx = (idx - 1 + DATA.length) % DATA.length;
  mcqState = null;
  renderFlash();
  render();
}
function flashNext(){
  if(!DATA || DATA.length===0) return;
  idx = (idx + 1) % DATA.length;
  mcqState = null;
  renderFlash();
  render();
}

/* ====== AUDIO + HAPTIC ====== */
let audioCtx=null;
function initAudio(){if(!audioCtx){try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){audioCtx=null;}}}
function beep({freq=880,dur=120,type='sine',vol=0.1}={}){if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); setTimeout(()=>{o.stop()}, dur);}
function sfxCorrect(){beep({freq:1046,dur:120,type:'triangle',vol:0.08}); setTimeout(()=>beep({freq:1318,dur:120,type:'triangle',vol:0.08}),120)}
function sfxWrong(){beep({freq:220,dur:160,type:'sawtooth',vol:0.06})}
function vibrate(pattern){if(navigator.vibrate) navigator.vibrate(pattern)}
window.addEventListener('pointerdown',()=>{initAudio(); if(audioCtx?.state==='suspended') audioCtx.resume();},{once:true});

/* ====== MCQ ====== */
function buildMCQState(){if(!DATA || DATA.length===0) return null; const i=order[idx]; const p=DATA[i]; const q = langDir==='kr2vi'? p.kr : p.vi; const answer = langDir==='kr2vi'? p.vi : p.kr; const pickWrong=(correctIndex,n=3)=>{const pool=[...Array(DATA.length).keys()].filter(k=>k!==correctIndex);shuffle(pool);return pool.slice(0,n)}; let opts=[answer,...pickWrong(i).map(j=> langDir==='kr2vi'? DATA[j].vi : DATA[j].kr)]; shuffle(opts); return {i, q, answer, opts, tried:new Set()}; }
function renderMCQ(){
  const mcqQ = document.getElementById('mcqQ');
  const box=document.getElementById('mcqOptions');
  if(!DATA || DATA.length===0){
    mcqQ.textContent = 'Nh√≥m r·ªóng';
    box.innerHTML = '<div class="tag">Kh√¥ng c√≥ d·ªØ li·ªáu</div>';
    return;
  }

  if(!mcqState || mcqState.i!==order[idx]) mcqState = buildMCQState();
  const {q, answer, opts} = mcqState;
  mcqQ.textContent=q;
  box.innerHTML='';
  opts.forEach(opt=>{
    const div=document.createElement('div'); div.className='mcq-option'; div.tabIndex=0;
    const emoji = isVI(opt)? emojiForVI(opt): '';
    if(emoji){
      const imgSpan = document.createElement('span'); imgSpan.className='img'; imgSpan.textContent = emoji;
      div.appendChild(imgSpan);
    }
    const txtSpan = document.createElement('span'); txtSpan.textContent = opt;
    div.appendChild(txtSpan);

    const choose = ()=>{
      initAudio();
      box.classList.add('disable-pointer');
      if(opt===answer){
        div.classList.add('correct'); score++; sfxCorrect(); vibrate([20,30,20]); showCenter('Th√πy Ch√¢m cutii gi·ªèi qu√° !!!');
        setTimeout(()=>{ idx=(idx+1)%DATA.length; mcqState=null; renderMCQ(); box.classList.remove('disable-pointer'); render(); },380);
      }else{
        div.classList.add('wrong'); sfxWrong(); vibrate([50,30,50]); document.getElementById('mcq').classList.add('shake');
        setTimeout(()=>document.getElementById('mcq').classList.remove('shake'),320);
        showCenter('Khum sao l√†m l·∫°i p√© ∆°i'); setTimeout(()=>box.classList.remove('disable-pointer'),320); render();
      }
    };

    div.onclick = choose;
    div.onkeydown = (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); choose(); } };
    box.appendChild(div);
  });
}

/* ====== MATCH ====== */
// Hi·ªÉn th·ªã theo ƒë·ª£t 10 c·∫∑p; n·ªëi xong ƒë·ª£t hi·ªán t·∫°i s·∫Ω t·ª± n·∫°p ƒë·ª£t k·∫ø ti·∫øp cho ƒë·∫øn h·∫øt
let matchPairs=[];      // c·∫∑p trong ƒë·ª£t hi·ªán t·∫°i (t·ªëi ƒëa 10)
let matchQueue=[];      // h√†ng ƒë·ª£i c√≤n l·∫°i (ch·ªâ s·ªë theo order)
let leftItems=[]; let rightItems=[];
function setupMatch(resetQueue=false){
  selectedLeft=null;
  // khi ƒë·ªïi nh√≥m ho·∫∑c mu·ªën reset, t·∫°o h√†ng ƒë·ª£i m·ªõi ch·ªâ t·ª´ c√°c ch·ªâ s·ªë trong group hi·ªán t·∫°i
  if(resetQueue || !matchQueue.length){
    // s·ª≠ d·ª•ng order (ƒë√£ ƒë∆∞·ª£c tr·ªôn khi ƒë·ªïi nh√≥m) nh∆∞ng sao ch√©p ƒë·ªÉ kh√¥ng s·ª≠a order g·ªëc
    matchQueue = shuffle(order.slice(0));
  }
  loadNextMatchBatch();
}
function loadNextMatchBatch(){
  // l·∫•y t·ªëi ƒëa 10 ph·∫ßn t·ª≠ t·ª´ h√†ng ƒë·ª£i; n·∫øu h·∫øt th√¨ tr·∫£ v·ªÅ m·∫£ng r·ªóng
  matchPairs = matchQueue.splice(0, Math.min(10, matchQueue.length));
  if(matchPairs.length === 0){
    leftItems = []; rightItems = [];
    return;
  }
  if(langDir==='kr2vi'){
    leftItems  = matchPairs.map(i=>({i, text: DATA[i]?.kr || '', isVI:false}));
    rightItems = shuffle(matchPairs.map(i=>({i, text: DATA[i]?.vi || '', isVI:true})));
  }else{
    leftItems  = matchPairs.map(i=>({i, text: DATA[i]?.vi || '', isVI:true}));
    rightItems = shuffle(matchPairs.map(i=>({i, text: DATA[i]?.kr || '', isVI:false})));
  }
}
function renderMatch(){
  const L=document.getElementById('matchLeft'); const R=document.getElementById('matchRight'); L.innerHTML=''; R.innerHTML='';
  if(!DATA || DATA.length===0){
    L.innerHTML = '<div class="tag">Nh√≥m r·ªóng</div>'; R.innerHTML = '';
    return;
  }
  if(leftItems.length===0 && rightItems.length===0 && matchQueue.length===0){
    // ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c·∫∑p trong nh√≥m
    L.innerHTML = '<div class="tag">Ho√†n th√†nh t·∫•t c·∫£ c·∫∑p trong nh√≥m üéâ</div>';
    R.innerHTML = '';
    return;
  }

  leftItems.forEach((l,idxL)=>{
    const a=document.createElement('div'); a.className='tile'; a.tabIndex=0;
    if(l.isVI){
      const em = emojiForVI(l.text);
      if(em){ const s=document.createElement('span'); s.className='img'; s.textContent=em; a.appendChild(s); }
    }
    const span=document.createElement('span'); span.textContent = l.text; a.appendChild(span);
    a.dataset.index=idxL;
    a.onclick=()=>{document.querySelectorAll('#matchLeft .tile').forEach(t=>t.classList.remove('selected')); a.classList.add('selected'); selectedLeft={i:l.i, el:a};};
    a.onkeydown=(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); a.click(); } };
    L.appendChild(a)
  });
  rightItems.forEach((r)=>{
    const b=document.createElement('div'); b.className='tile'; b.tabIndex=0;
    if(r.isVI){
      const em = emojiForVI(r.text);
      if(em){ const s=document.createElement('span'); s.className='img'; s.textContent=em; b.appendChild(s); }
    }
    const span=document.createElement('span'); span.textContent = r.text; b.appendChild(span);
    b.dataset.i = r.i;
    b.onclick=()=>{ initAudio(); if(!selectedLeft) return; const left = selectedLeft;
      // t√¨m index hi·ªán t·∫°i theo id th·ª±c (kh√¥ng d√πng idxR/left.idx v√¨ ƒë√£ re-render c√≥ th·ªÉ thay ƒë·ªïi)
      const rightIndex = rightItems.findIndex(x=>x.i === r.i);
      const leftIndex  = leftItems.findIndex(x=>x.i === left.i);
      if(leftIndex === -1 || rightIndex === -1) return; // ƒë√£ b·ªã x√≥a tr∆∞·ªõc ƒë√≥
      if(left.i === r.i){
        b.classList.add('correct'); left.el.classList.add('correct'); score++; sfxCorrect(); vibrate([20,30,20]); showCenter('Th√πy Ch√¢m cutii gi·ªèi qu√° !!!');
        setTimeout(()=>{
          // x√≥a ph·∫ßn t·ª≠ theo index th·ª±c
          leftItems.splice(leftIndex,1);
          rightItems.splice(rightIndex,1);
          selectedLeft=null;
          if(leftItems.length===0){
            if(matchQueue.length>0){
              loadNextMatchBatch();
              renderMatch();
              showCenter('Ti·∫øp t·ª•c ƒë·ª£t m·ªõi üëè');
            }else{
              renderMatch();
              showCenter('Ho√†n th√†nh t·∫•t c·∫£ c·∫∑p! Tuy·ªát üëè');
            }
          }else{
            renderMatch();
          }
          render();
        },320);
      }else{
        b.classList.add('wrong'); left.el.classList.add('wrong'); sfxWrong(); vibrate([60,30,60]); document.getElementById('match').classList.add('shake');
        setTimeout(()=>{b.classList.remove('wrong'); left.el.classList.remove('wrong'); document.getElementById('match').classList.remove('shake');},380);
        showCenter('Khum sao l√†m l·∫°i p√© ∆°i');
      }
    };
    b.onkeydown=(e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); b.click(); } };
    R.appendChild(b)
  });
}

/* ====== SPELL ====== */
let spellAnswer='';
function renderSpell(){if(!DATA || DATA.length===0){ document.getElementById('spellQ').textContent='Nh√≥m r·ªóng'; document.getElementById('spellTip').textContent=''; document.getElementById('spellIn').value=''; return; } const p=currentPair(); const q= langDir==='kr2vi'? p.kr : p.vi; const ans = langDir==='kr2vi'? p.vi : p.kr; document.getElementById('spellQ').textContent=q; document.getElementById('spellTip').textContent='G·ª£i √Ω: '+(ans.length>2? ans[0]+'...' : ''); spellAnswer=ans; const inp=document.getElementById('spellIn'); inp.value=''; inp.focus();}
function checkSpell(){initAudio(); const val=document.getElementById('spellIn').value.trim(); if(!val) return; if(val.normalize('NFC').toLowerCase()===spellAnswer.normalize('NFC').toLowerCase()){score++; sfxCorrect(); vibrate([20,30,20]); showCenter('Th√πy Ch√¢m cutii gi·ªèi qu√° !!!'); idx=(idx+1)%DATA.length; renderSpell();} else {sfxWrong(); vibrate([60,30,60]); showCenter('Khum sao l√†m l·∫°i p√© ∆°i')} render();}

/* ====== Group selector helpers (restore group select feature) ====== */
function populateGroupSelector(){
  const sel = document.getElementById('groupSelect');
  if(!sel) return;
  sel.innerHTML = '';
  Object.keys(GROUPS).forEach(name=>{
    const opt = document.createElement('option');
    opt.value = name;
    opt.textContent = name;
    sel.appendChild(opt);
  });
  if(GROUPS[currentGroup]) sel.value = currentGroup;
  else {
    const first = Object.keys(GROUPS)[0];
    currentGroup = first;
    sel.value = first;
    DATA = GROUPS[first] || [];
  }
  updateControls();
}

function switchGroup(name){
  if(!GROUPS[name]) return;
  currentGroup = name;
  DATA = GROUPS[name] || [];
  order = DATA.map((_,i)=>i); shuffle(order);
  idx = 0; score = 0; mcqState = null; selectedLeft = null;
  setupMatch(true);
  updateControls();
  render();
  showCenter('ƒê√£ chuy·ªÉn nh√≥m: ' + name);
}

function updateControls(){
  const empty = !DATA || DATA.length === 0;
  document.querySelectorAll('nav button').forEach(b=>b.disabled = empty);
  const prevBtn = document.getElementById('flashPrev');
  const nextBtn = document.getElementById('flashNext');
  if(prevBtn) prevBtn.disabled = empty;
  if(nextBtn) nextBtn.disabled = empty;
  const lang = document.getElementById('langDir'); if(lang) lang.disabled = empty;
  const imgT = document.getElementById('imgToggle'); if(imgT) imgT.disabled = empty;
  const gsel = document.getElementById('groupSelect'); if(gsel) gsel.disabled = false;
}

/* ====== INIT ====== */
populateGroupSelector();
order = DATA.map((_,i)=>i);
shuffle(order);
setupMatch(true);
render();
</script>
</body>
</html>
