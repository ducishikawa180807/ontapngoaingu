
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="theme-color" content="#0f172a" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>√în t·∫≠p ti·∫øng H√†n ‚Äî Mi√™u t·∫£ m√≥n ƒÉn (v5)</title>
<style>
 :root{--bg:#0f172a;--card:#111827;--pri:#22d3ee;--ok:#22c55e;--bad:#ef4444;--text:#e5e7eb;--muted:#9ca3af}
 *{box-sizing:border-box;-webkit-tap-highlight-color: transparent}
 html, body{height:100%;}
 body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif;background:linear-gradient(120deg,#0f172a,#0b1023);color:var(--text);min-height:100dvh;}
 header{padding:16px 12px;text-align:center;position:sticky;top:0;background:linear-gradient(120deg,#0f172a,#0b1023);z-index:10}
 header h1{margin:0;font-size:clamp(18px,4.5vw,26px)}
 .wrap{max-width:1100px;margin:0 auto;padding:10px 12px 84px}
 /* Sticky bottom nav for mobile */
 nav{position:fixed;left:0;right:0;bottom:0;background:#0b1220cc;backdrop-filter:blur(6px);display:flex;gap:8px;flex-wrap:nowrap;overflow-x:auto;padding:10px 12px;border-top:1px solid #334155;z-index:20}
 nav::-webkit-scrollbar{display:none}
 button,select,label.switch{white-space:nowrap}
 button,select{background:var(--card);color:var(--text);border:1px solid #334155;border-radius:12px;padding:12px 14px;cursor:pointer;font-size:16px}
 button:active{transform:scale(0.98)}
 .pill{border-radius:999px}
 .card{background:radial-gradient(1200px 600px at -10% -30%,#1f2937,transparent),var(--card);border:1px solid #334155;border-radius:16px;padding:14px;margin-bottom:12px}
 .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
 .hidden{display:none}
 .score{font-weight:700}
 .tag{font-size:12px;color:var(--muted)}
 .k{font-size:clamp(18px,5vw,24px)}
 .v{color:#94a3b8}
 .timer{font-variant-numeric:tabular-nums}
 .mcq-option{padding:14px;border:1px solid #334155;border-radius:14px;background:#0b1220;cursor:pointer;display:flex;align-items:center;gap:10px;min-height:56px}
 .mcq-option .img{font-size:22px}
 .mcq-option.correct{border-color:var(--ok);background:#052915}
 .mcq-option.wrong{border-color:var(--bad);background:#290909}
 .disable-pointer{pointer-events:none;}
 .shake{animation:shake .3s}
 @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
 .match-wrap{display:grid;grid-template-columns:1fr 1fr;gap:10px}
 .col{display:flex;flex-direction:column;gap:8px}
 .tile{padding:14px;border:1px solid #334155;border-radius:14px;background:#0b1220;cursor:pointer;display:flex;align-items:center;gap:10px;min-height:56px}
 .tile .img{font-size:22px}
 .tile.selected{outline:2px solid #22c55e; background:#052915}
 .tile.correct{border-color:var(--ok);background:#052915}
 .tile.wrong{border-color:var(--bad);background:#290909}
 #centerOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:9999}
 #centerBox{background:#0b1220;border:1px solid #334155;border-radius:16px;padding:16px 22px;font-size:clamp(18px,5vw,28px);text-align:center}
 .switch{display:inline-flex;align-items:center;gap:8px}
 @media (prefers-reduced-motion: reduce){*{scroll-behavior:auto} #centerOverlay{transition:none}}
 /* Mobile: keep 2 columns for match mode (CSS-only change) */
 @media (max-width:640px){
   .grid{grid-template-columns:1fr}
   .match-wrap{grid-template-columns:1fr 1fr}
   .wrap{padding-bottom:100px}
 }

 /* Thu nh·ªè k√≠ch th∆∞·ªõc selector nh√≥m t·ª´ v·ª±ng (kh√¥ng ƒë·ªïi layout) */
 #groupSelect{
   padding:8px 12px; font-size:14px; width:auto; max-width:120px;
 }
</style>
</head>
<body>
<header>
  <h1>üéÆ √în t·∫≠p t·ª´ v·ª±ng ti·∫øng H√†n: Mi√™u t·∫£ & c·∫£m nh·∫≠n m√≥n ƒÉn</h1>
</header>
<div class="wrap">
  <section id="flash" class="card">
    <h2>Flashcards</h2>
    <div id="flashCard" class="card" style="text-align:center;cursor:pointer">
      <div class="k" id="flashFront"></div>
      <div class="v" id="flashBack" style="margin-top:8px"></div>
      <div class="tag">Ch·∫°m ƒë·ªÉ l·∫≠t / vu·ªët ‚óÄ ‚ñ∂ ƒë·ªÉ chuy·ªÉn</div>
    </div>
  </section>

  <section id="mcq" class="card hidden">
    <h2>Tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn</h2>
    <div id="mcqQ" class="k"></div>
    <div id="mcqOptions" class="grid" style="margin-top:10px"></div>
  </section>

  <section id="match" class="card hidden">
    <h2>N·ªëi c·∫∑p ƒë√∫ng</h2>
    <div class="match-wrap">
      <div class="col" id="matchLeft"></div>
      <div class="col" id="matchRight"></div>
    </div>
  </section>

  <section id="spell" class="card hidden">
    <h2>Ch√≠nh t·∫£</h2>
    <div id="spellQ" class="k"></div>
    <input id="spellIn" type="text" placeholder="Nh·∫≠p ƒë√°p √°n..." style="width:100%;margin:8px 0;padding:14px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:var(--text);font-size:18px" />
    <button onclick="checkSpell()">Ki·ªÉm tra</button>
    <div id="spellTip" class="tag"></div>
  </section>
</div>

<nav>
  <button class="pill" onclick="switchMode('flash')">üîÅ Flash</button>
  <button class="pill" onclick="switchMode('mcq')">üß† Tr·∫Øc nghi·ªám</button>
  <button class="pill" onclick="switchMode('match')">üß© N·ªëi c·∫∑p</button>
  <button class="pill" onclick="switchMode('spell')">‚úçÔ∏è Ch√≠nh t·∫£</button>

  <!-- Group selector (added; minimal change; same style) -->
  <select id="groupSelect" onchange="switchGroup(this.value)" title="Ch·ªçn nh√≥m t·ª´ v·ª±ng"></select>

  <select id="langDir" onchange="resetGame()">
    <option value="kr2vi">H√†n ‚ûú Vi·ªát</option>
    <option value="vi2kr">Vi·ªát ‚ûú H√†n</option>
  </select>

  <label class="switch">
    <input type="checkbox" id="imgToggle" checked onchange="render()" /> Emoji VN
  </label>
  <button onclick="shuffleAll()">üîÄ Tr·ªôn</button>
  <span class="score">ƒêi·ªÉm: <span id="score">0</span></span>
  <span class="timer">‚è±Ô∏è <span id="timer">60</span>s</span>
  <button onclick="restartTimer()">‚Üª</button>
</nav>

<div id="centerOverlay"><div id="centerBox"></div></div>

<script>
// ====== GROUPS & DATA ======
const GROUPS = {
  "__Builtin__": [
    {"kr": "ÎßõÏûàÎã§", "vi": "ngon"},
    {"kr": "ÎßõÏóÜÎã§", "vi": "kh√¥ng ngon"},
    {"kr": "Îã¨Îã§", "vi": "ng·ªçt"},
    {"kr": "ÏßúÎã§", "vi": "m·∫∑n"},
    {"kr": "Ïß≠Ïß§ÌïòÎã§", "vi": "h∆°i m·∫∑n"},
    {"kr": "ÏãúÎã§", "vi": "chua"},
    {"kr": "ÎßµÎã§", "vi": "cay"},
    {"kr": "Ïì∞Îã§", "vi": "ƒë·∫Øng"},
    {"kr": "Ïã±Í≤ÅÎã§", "vi": "nh·∫°t"},
    {"kr": "Ïã†ÏÑ†ÌïòÎã§", "vi": "t∆∞∆°i"},
    {"kr": "Î∂ÄÎìúÎüΩÎã§", "vi": "m·ªÅm"},
    {"kr": "ÎäêÎÅºÌïòÎã§", "vi": "b√©o ng·∫≠y (nhi·ªÅu d·∫ßu m·ª°)"},
    {"kr": "Îã¥Î∞±ÌïòÎã§", "vi": "thanh ƒë·∫°m"}
  ],

  "50 T·ª™ V√ôNG DI·ªÑN T·∫¢ T√åNH HU·ªêNG S·∫º X·∫¢Y RA TRONG B·∫æP": [
    {"kr":"ÏîªÎã§","vi":"R·ª≠a"},
    {"kr":"Ìï¥ÎèôÌïòÎã§","vi":"R√£ ƒë√¥ng"},
    {"kr":"ÏñëÌååÎ•º ÏûêÎ•¥Îã§","vi":"C·∫Øt h√†nh"},
    {"kr":"ÎßàÎäòÏùÑ ÍπåÎã§","vi":"B√≥c t·ªèi"},
    {"kr":"ÍπÄÏπòÎ•º Ïç∞Îã§","vi":"Th√°i nh·ªè kimchi"},
    {"kr":"Ï±ÑÏÜåÎ•º ÏîªÎã§","vi":"R·ª≠a rau"},
    {"kr":"ÏñëÎÖêÏùÑ Ï§ÄÎπÑÌïòÎã§","vi":"Chu·∫©n b·ªã gia v·ªã"},
    {"kr":"Ïû¨Î£åÎ•º Ïû¨Îã§","vi":"C√¢n nguy√™n li·ªáu"},
    {"kr":"Í∞êÏûêÎ•º ÍπéÎã§","vi":"G·ªçt khoai t√¢y"},
    {"kr":"ÏüÅÎ∞òÏóê Ïò¨Î¶¨Îã§","vi":"X·∫øp rau v√†o khay"},
    {"kr":"Í≥ÑÎûÄÏùÑ Î∂ÄÏπòÎã§","vi":"Chi√™n tr·ª©ng"},
    {"kr":"Ï±ÑÏÜåÎ•º Î≥∂Îã§","vi":"X√†o rau"},
    {"kr":"Î©¥ÏùÑ ÏÇ∂Îã§","vi":"Lu·ªôc m√¨"},
    {"kr":"Í≥†Í∏∞Î•º ÎÅìÏù¥Îã§","vi":"H·∫ßm th·ªãt"},
    {"kr":"ÏÜåÍ∏àÏùÑ ÎÑ£Îã§","vi":"N√™m mu·ªëi"},
    {"kr":"Í∏∞Î¶ÑÏùÑ ÎëêÎ•¥Îã§","vi":"Cho d·∫ßu ƒÉn"},
    {"kr":"Ïûò Ï†ÄÏñ¥ Ï£ºÎã§","vi":"ƒê·∫£o ƒë·ªÅu"},
    {"kr":"Î¨ºÏùÑ Î∂ìÎã§","vi":"Th√™m n∆∞·ªõc"},
    {"kr":"ÏÉùÏÑ†ÏùÑ ÍµΩÎã§","vi":"N∆∞·ªõng c√°"},
    {"kr":"ÎßåÎëêÎ•º Ï∞åÎã§","vi":"H·∫•p b√°nh bao"},
    {"kr":"Í∑∏Î¶áÏùÑ Í∞ÄÏ†∏Ïò§Îã§","vi":"L·∫•y b√°t"},
    {"kr":"ÏàòÏ†Ä Ï§ÄÎπÑÌïòÎã§","vi":"L·∫•y th√¨a ƒë≈©a"},
    {"kr":"Ï†ëÏãúÏóê Îã¥Îã§","vi":"S·∫Øp x·∫øp th·ª©c ƒÉn l√™n ƒëƒ©a"},
    {"kr":"ÏàòÎüâÏùÑ ÌôïÏù∏ÌïòÎã§","vi":"Ki·ªÉm tra s·ªë l∆∞·ª£ng"},
    {"kr":"ÏùåÏãùÏùÑ Ïû•ÏãùÌïòÎã§","vi":"Trang tr√≠ m√≥n ƒÉn"},
    {"kr":"Ï£ºÎ∞© Ï∞ΩÍµ¨Ïóê Ïò¨Î¶¨Îã§","vi":"ƒê·∫∑t m√≥n ra c·ª≠a b·∫øp"},
    {"kr":"ÏÑúÎ≤ÑÏßÅÏõêÏóêÍ≤å Î∂ÄÎ•¥Îã§","vi":"G·ªçi ph·ª•c v·ª• ƒë·∫øn l·∫•y"},
    {"kr":"Ïû¨Î£åÍ∞Ä Îã§ Îñ®Ïñ¥Ï°åÎã§","vi":"B√°o h·∫øt nguy√™n li·ªáu"},
    {"kr":"ÎßõÏùÑ Î≥¥Îã§","vi":"Th·ª≠ v·ªã"},
    {"kr":"Ïò®ÎèÑÎ•º ÌôïÏù∏ÌïòÎã§","vi":"Ki·ªÉm tra nhi·ªát ƒë·ªô"},
    {"kr":"ÏÑ§Í±∞ÏßÄÎ•º ÌïòÎã§","vi":"R·ª≠a b√°t"},
    {"kr":"ÌÖåÏù¥Î∏îÏùÑ Îã¶Îã§","vi":"Lau b√†n"},
    {"kr":"Î∞îÎã•ÏùÑ Îã¶Îã§","vi":"Lau s√†n"},
    {"kr":"Ïì∞Î†àÍ∏∞Î•º Î≤ÑÎ¶¨Îã§","vi":"ƒê·ªï r√°c"},
    {"kr":"ÌñâÏ£ºÎ•º Í∞ÄÏ†∏Ïò§Îã§","vi":"ƒêem khƒÉn lau"},
    {"kr":"ÎÉÑÏÉàÎ•º ÏóÜÏï†Îã§","vi":"Kh·ª≠ m√πi"},
    {"kr":"ÏπºÏùÑ Ï†ïÎ¶¨ÌïòÎã§","vi":"C·∫•t dao k√©o"},
    {"kr":"ÏñëÎÖêÏùÑ Ï†ïÎ¶¨ÌïòÎã§","vi":"C·∫•t gia v·ªã"},
    {"kr":"Í∞ÄÏä§Î•º Îã¶Îã§","vi":"Lau b·∫øp ga"},
    {"kr":"ÎÉâÏû•Í≥†Î•º Ï†ïÎ¶¨ÌïòÎã§","vi":"D·ªçn t·ªß l·∫°nh"},
    {"kr":"Í∏∞Î¶ÑÏù¥ ÏèüÏïÑÏ°åÎã§","vi":"B·ªã ƒë·ªï d·∫ßu"},
    {"kr":"Î∂àÏù¥ ÎÇ¨Îã§","vi":"B·ªã ch√°y"},
    {"kr":"ÏÜêÏùÑ Î≤†ÏòÄÎã§","vi":"C·∫Øt v√†o tay"},
    {"kr":"Î¨ºÏù¥ ÎÑòÏ≥§Îã§","vi":"N∆∞·ªõc s√¥i tr√†o ra"},
    {"kr":"Íµ≠Ïù¥ ÏèüÏïÑÏ°åÎã§","vi":"ƒê·ªï canh"},
    {"kr":"Í∑∏Î¶áÏù¥ Íπ®Ï°åÎã§","vi":"L√†m v·ª° b√°t"},
    {"kr":"ÌôîÏÉÅÏùÑ ÏûÖÏóàÎã§","vi":"B·ªã b·ªèng"},
    {"kr":"Ïù∏ÏõêÏù¥ Î∂ÄÏ°±ÌïòÎã§","vi":"Thi·∫øu nh√¢n vi√™n"},
    {"kr":"ÌôòÌíçÍ∏∞Í∞Ä Í≥†Ïû•ÎÇ¨Îã§","vi":"M√°y h√∫t m√πi h·ªèng"},
    {"kr":"ÏÜêÎãòÏù¥ Îπ®Î¶¨ Îã¨ÎùºÍ≥† ÌïòÎã§","vi":"Kh√°ch g·ªçi m√≥n g·∫•p"}
  ],

  ". T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ gia v·ªã n·∫•u ƒÉn (1)": [
    {"kr":"ÏÑ§ÌÉï","vi":"ƒê∆∞·ªùng"},
    {"kr":"ÏÜåÍ∏à","vi":"Mu·ªëi"},
    {"kr":"ÎØ∏Ïõê, ÌôîÌïôÏ°∞ÎØ∏Î£å","vi":"B·ªôt ng·ªçt, m√¨ ch√≠nh"},
    {"kr":"Í≥†Ï∂ßÍ∞ÄÎ£®","vi":"·ªöt b·ªôt"},
    {"kr":"ÌõÑÏ∂î","vi":"Ti√™u"},
    {"kr":"ÏãùÏ¥à","vi":"Gi·∫•m"},
    {"kr":"ÌîºÏãúÏÜåÏä§, ÌîºÏâ¨ÏÜåÏä§","vi":"N∆∞·ªõc m·∫Øm"},
    {"kr":"Í∞ÑÏû•","vi":"N∆∞·ªõc t∆∞∆°ng"},
    {"kr":"ÏãùÏö©Ïú†","vi":"D·∫ßu ƒÉn"},
    {"kr":"Íµ¥ÏÜåÏä§","vi":"D·∫ßu h√†o"},
    {"kr":"Ï∞∏Í∏∞Î¶Ñ","vi":"D·∫ßu m√®"},
    {"kr":"Í≥†Ï∂îÏû•","vi":"T∆∞∆°ng ·ªõt"},
    {"kr":"ÎêúÏû•","vi":"T∆∞∆°ng ƒë·∫≠u"},
    {"kr":"Î∂ÄÏπòÎã§","vi":"Chi√™n, r√°n"},
    {"kr":"ÌäÄÍ∏∞Îã§","vi":"Chi√™n (ng·∫≠p d·∫ßu)"},
    {"kr":"Î≥∂Îã§","vi":"X√†o"},
    {"kr":"ÏÇ∂Îã§","vi":"Lu·ªôc"},
    {"kr":"Ï∞åÎã§","vi":"H·∫•p"},
    {"kr":"ÍµΩÎã§","vi":"N∆∞·ªõng"},
    {"kr":"ÎÅìÏù¥Îã§","vi":"ƒêun s√¥i, n·∫•u"},
    {"kr":"Îç∞ÏπòÎã§","vi":"Tr·ª•ng, tr·∫ßn"},
    {"kr":"Ï°∏Ïù¥Îã§","vi":"Ninh, h·∫ßm"},
    {"kr":"ÏûêÎ•¥Îã§","vi":"C·∫Øt"},
    {"kr":"Ïç∞Îã§","vi":"Th√°i s·ª£i, c·∫Øt l√°t"},
    {"kr":"Îã§ÏßÄÎã§","vi":"Gi√£ b·∫±m, bƒÉm nh·ªè"},
    {"kr":"Ïã∏Îã§","vi":"G√≥i, cu·ªën"},
    {"kr":"ÎÑ£Îã§","vi":"B·ªè v√†o"},
    {"kr":"ÎπÑÎπÑÎã§","vi":"Tr·ªôn, qu·∫•y"},
    {"kr":"ÎßõÏùÑ Î≥¥Îã§","vi":"N√™m n·∫øm"}
  ],

  "ƒë·∫°o c·ª• b·∫øp (1)": [
    {"kr":"Ïπº, ÏãùÏπº","vi":"Dao"},
    {"kr":"ÏàüÍ∞ÄÎùΩ","vi":"Mu·ªóng, th√¨a"},
    {"kr":"Ìè¨ÌÅ¨","vi":"Nƒ©a"},
    {"kr":"ÏßëÍ≤å","vi":"K·∫πp (g·∫Øp ƒë·ªì ƒÉn)"},
    {"kr":"Íµ≠Ïûê","vi":"Mu√¥i, v√° (m√∫c canh)"},
    {"kr":"Îí§ÏßëÍ∞ú","vi":"X·∫ªng (n·∫•u ƒÉn)"},
    {"kr":"Í∑∏Î¶á","vi":"T√¥"},
    {"kr":"Î∞•Í∑∏Î¶á","vi":"Ch√©n, b√°t c∆°m"},
    {"kr":"Ï†ëÏãú","vi":"ƒêƒ©a"},
    {"kr":"Ïªµ","vi":"C·ªëc, ly"},
    {"kr":"Ïú†Î¶¨Ïûî","vi":"C·ªëc, ly th·ªßy tinh"},
    {"kr":"ÎèÑÎßà","vi":"Th·ªõt"},
    {"kr":"Ï£ºÍ±±","vi":"V√° m√∫c c∆°m"},
    {"kr":"ÎöúÍªë","vi":"N·∫Øp"},
    {"kr":"Ï†ÑÍ∏∞Î∞•ÏÜ•","vi":"N·ªìi c∆°m ƒëi·ªán"},
    {"kr":"ÎåÄÏïº","vi":"Thau, ch·∫≠u"},
    {"kr":"ÏÜåÏø†Î¶¨","vi":"R·ªï tre"},
    {"kr":"ÎÉÑÎπÑ","vi":"N·ªìi, xoong"},
    {"kr":"ÌîÑÎùºÏù¥Ìå¨","vi":"Ch·∫£o"},
    {"kr":"Ïò§Î∏ê","vi":"L√≤ n∆∞·ªõng"},
    {"kr":"Ï†ÑÏûêÎ†àÏù∏ÏßÄ","vi":"L√≤ vi s√≥ng"},
    {"kr":"ÎÉâÏû•Í≥†","vi":"T·ªß l·∫°nh"},
    {"kr":"ÎÇúÎ°ú","vi":"B·∫øp l√≤"},
    {"kr":"ÏãùÌÉÅ","vi":"B√†n ƒÉn"},
    {"kr":"ÏãùÍ∏∞ÏÑ∏Ï≤ôÍ∏∞","vi":"M√°y r·ª≠a ch√©n"},
    {"kr":"ÎØπÏÑúÍ∏∞","vi":"M√°y xay sinh t·ªë"},
    {"kr":"Ï¶ôÏÑúÍ∏∞","vi":"M√°y √©p"}
  ],

  ". T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ gia v·ªã n·∫•u ƒÉn": [
    {"kr":"ÏÑ§ÌÉï","vi":"ƒê∆∞·ªùng"},
    {"kr":"ÏÜåÍ∏à","vi":"Mu·ªëi"},
    {"kr":"ÎØ∏Ïõê, ÌôîÌïôÏ°∞ÎØ∏Î£å","vi":"B·ªôt ng·ªçt, m√¨ ch√≠nh"},
    {"kr":"Í≥†Ï∂ßÍ∞ÄÎ£®","vi":"·ªöt b·ªôt"},
    {"kr":"ÌõÑÏ∂î","vi":"Ti√™u"},
    {"kr":"ÏãùÏ¥à","vi":"Gi·∫•m"},
    {"kr":"ÌîºÏãúÏÜåÏä§, ÌîºÏâ¨ÏÜåÏä§","vi":"N∆∞·ªõc m·∫Øm"},
    {"kr":"Í∞ÑÏû•","vi":"N∆∞·ªõc t∆∞∆°ng"},
    {"kr":"ÏãùÏö©Ïú†","vi":"D·∫ßu ƒÉn"},
    {"kr":"Íµ¥ÏÜåÏä§","vi":"D·∫ßu h√†o"},
    {"kr":"Ï∞∏Í∏∞Î¶Ñ","vi":"D·∫ßu m√®"},
    {"kr":"Í≥†Ï∂îÏû•","vi":"T∆∞∆°ng ·ªõt"},
    {"kr":"ÎêúÏû•","vi":"T∆∞∆°ng ƒë·∫≠u"},
    {"kr":"Î∂ÄÏπòÎã§","vi":"Chi√™n, r√°n"},
    {"kr":"ÌäÄÍ∏∞Îã§","vi":"Chi√™n (ng·∫≠p d·∫ßu)"},
    {"kr":"Î≥∂Îã§","vi":"X√†o"},
    {"kr":"ÏÇ∂Îã§","vi":"Lu·ªôc"},
    {"kr":"Ï∞åÎã§","vi":"H·∫•p"},
    {"kr":"ÍµΩÎã§","vi":"N∆∞·ªõng"},
    {"kr":"ÎÅìÏù¥Îã§","vi":"ƒêun s√¥i, n·∫•u"},
    {"kr":"Îç∞ÏπòÎã§","vi":"Tr·ª•ng, tr·∫ßn"},
    {"kr":"Ï°∏Ïù¥Îã§","vi":"Ninh, h·∫ßm"},
    {"kr":"ÏûêÎ•¥Îã§","vi":"C·∫Øt"},
    {"kr":"Ïç∞Îã§","vi":"Th√°i s·ª£i, c·∫Øt l√°t"},
    {"kr":"Îã§ÏßÄÎã§","vi":"Gi√£ b·∫±m, bƒÉm nh·ªè"},
    {"kr":"Ïã∏Îã§","vi":"G√≥i, cu·ªën"},
    {"kr":"ÎÑ£Îã§","vi":"B·ªè v√†o"},
    {"kr":"ÎπÑÎπÑÎã§","vi":"Tr·ªôn, qu·∫•y"},
    {"kr":"ÎßõÏùÑ Î≥¥Îã§","vi":"N√™m n·∫øm"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ nh√† b·∫øp.docx3": [
    {"kr":"ÏÜåÍ≥†Í∏∞","vi":"th·ªãt b√≤"},
    {"kr":"ÎèºÏßÄÍ≥†Í∏∞","vi":"th·ªãt l·ª£n"},
    {"kr":"Ïò§Î¶¨Í≥†Í∏∞","vi":"th·ªãt v·ªãt"},
    {"kr":"Îã≠Í≥†Í∏∞","vi":"th·ªãt g√†"},
    {"kr":"Îã≠Í∞ÄÏä¥ÏÇ¥","vi":"·ª©c g√†"},
    {"kr":"Îã≠ÎÇ†Í∞ú","vi":"c√°nh g√†"},
    {"kr":"Îã≠Îã§Î¶¨","vi":"ƒë√πi g√†"},
    {"kr":"Ïû•Ïñ¥","vi":"l∆∞∆°n"},
    {"kr":"ÏÉùÏÑ†","vi":"c√°"},
    {"kr":"Í≤å","vi":"cua"},
    {"kr":"ÏÉàÏö∞","vi":"t√¥m"},
    {"kr":"Íº¨Îßâ","vi":"s√≤ huy·∫øt"},
    {"kr":"Ïû¨Ï≤©","vi":"h·∫øn"},
    {"kr":"Ï†ÑÎ≥µ","vi":"b√†o ng∆∞"},
    {"kr":"Ïò§ÏßïÏñ¥","vi":"m·ª±c"},
    {"kr":"Îã¨Í±Ä","vi":"tr·ª©ng"},
    {"kr":"ÎëêÎ∂Ä","vi":"ƒë·∫≠u ph·ª•"},
    {"kr":"ÏñëÌåå","vi":"h√†nh t√¢y"},
    {"kr":"ÎåÄÌåå","vi":"h√†nh baro"},
    {"kr":"ÏàôÏ£ºÎÇòÎ¨º","vi":"gi√° ƒë·ªó"},
    {"kr":"ÍπÄÏπò","vi":"kim chi"},
    {"kr":"Í≥µÏã¨Ï±Ñ","vi":"rau mu·ªëng"},
    {"kr":"Î∞∞Ï∂î","vi":"c·∫£i th·∫£o"},
    {"kr":"Î≥ëÌíÄ","vi":"rau m√°"},
    {"kr":"Î≤ÑÏÑØ","vi":"n·∫•m"},
    {"kr":"ÌíÄÎ≤ÑÏÑØ / Ïû£Î≤ÑÏÑØ","vi":"n·∫•m r∆°m"},
    {"kr":"Í∞êÏûê","vi":"khoai t√¢y"},
    {"kr":"ÎãπÍ∑º","vi":"c√† r·ªët"},
    {"kr":"Ïò§Ïù¥","vi":"d∆∞a leo, d∆∞a chu·ªôt"},
    {"kr":"ÌÜ†ÎßàÌÜ†","vi":"c√† chua"},
    {"kr":"ÏàòÏÑ∏ÎØ∏","vi":"m∆∞·ªõp"},
    {"kr":"Í≥†Íµ¨Îßà","vi":"khoai lang"},
    {"kr":"Ìò∏Î∞ï","vi":"b√≠ ng√¥"},
    {"kr":"Ïï†Ìò∏Î∞ï","vi":"b√≠ ng√≤i"},
    {"kr":"Î†àÎ™¨","vi":"chanh"},
    {"kr":"ÎïÖÏΩ©","vi":"ƒë·∫≠u ph·ªông, l·∫°c"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ nh√† b·∫øp.docx 2": [
    {"kr":"ÎÉÑÎπÑ","vi":"n·ªìi, xoong"},
    {"kr":"ÌîÑÎùºÏù¥Ìå¨","vi":"ch·∫£o"},
    {"kr":"Ï†ÑÍ∏∞Î∞•ÏÜ•","vi":"n·ªìi c∆°m ƒëi·ªán"},
    {"kr":"Ïò§Î∏ê","vi":"l√≤ n∆∞·ªõng"},
    {"kr":"ÏïïÎ†•ÏÜ•","vi":"n·ªìi √°p su·∫•t"},
    {"kr":"Í∞ÄÏä§Î†àÏù∏ÏßÄ","vi":"b·∫øp gas"},
    {"kr":"Ï†ÑÍ∏∞Î†àÏù∏ÏßÄ","vi":"b·∫øp t·ª´"},
    {"kr":"ÏãùÌÉÅ","vi":"b√†n ƒÉn"},
    {"kr":"ÎÉâÏû•Í≥†","vi":"t·ªß l·∫°nh"},
    {"kr":"Ï∞¨Ïû•","vi":"t·ªß b·∫øp, t·ªß ƒë·ª±ng ch√©n b√°t"},
    {"kr":"Ïπº","vi":"dao"},
    {"kr":"Í∞ÄÏúÑ","vi":"k√©o"},
    {"kr":"Ï†ëÏãú","vi":"ƒëƒ©a"},
    {"kr":"Í∑∏Î¶á","vi":"t√¥, ch√©n, b√°t"},
    {"kr":"ÏàòÏ†Ä","vi":"th√¨a v√† ƒë≈©a"},
    {"kr":"ÏàüÍ∞ÄÎùΩ","vi":"th√¨a (mu·ªóng)"},
    {"kr":"Ï†ìÍ∞ÄÎùΩ","vi":"ƒë≈©a"},
    {"kr":"Ìè¨ÌÅ¨","vi":"nƒ©a"},
    {"kr":"Ïªµ","vi":"c·ªëc, ly"},
    {"kr":"Ïú†Î¶¨Ïûî","vi":"c·ªëc, ly th·ªßy tinh"},
    {"kr":"Î∞îÍ∞ÄÏßÄ","vi":"c√°i g√°o"},
    {"kr":"ÏÜåÏø†Î¶¨","vi":"c√°i r·ªï"},
    {"kr":"Íµ≠Ïûê","vi":"c√°i mu√¥i, c√°i v√°"},
    {"kr":"Î∂àÌåê","vi":"v·ªâ n∆∞·ªõng"},
    {"kr":"ÏüÅÎ∞ò","vi":"khay, m√¢m"},
    {"kr":"ÏïûÏπòÎßà","vi":"t·∫°p d·ªÅ"},
    {"kr":"ÎÉÖÌÇ®","vi":"khƒÉn ƒÉn, gi·∫•y ƒÉn"},
    {"kr":"Ïù¥Ïë§ÏãúÍ∞ú","vi":"tƒÉm"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ nh√† b·∫øp": [
    {"kr":"Î≥∂Îã§","vi":"chi√™n, x√†o s·ª≠ d·ª•ng √≠t d·∫ßu (chi√™n c∆°m, x√†o rau,‚Ä¶)"},
    {"kr":"ÌäÄÍ∏∞Îã§","vi":"chi√™n ng·∫≠p d·∫ßu"},
    {"kr":"ÍµΩÎã§","vi":"n∆∞·ªõng"},
    {"kr":"ÎÅìÏù¥Îã§","vi":"n·∫•u s√¥i, ƒëun s√¥i"},
    {"kr":"Ï∞åÎã§","vi":"ch∆∞ng, h·∫•p"},
    {"kr":"ÏÇ∂Îã§","vi":"lu·ªôc"},
    {"kr":"Îç∞ÏπòÎã§","vi":"tr·ª•ng, lu·ªôc s∆°"},
    {"kr":"Í∞ÄÏó¥ÌïòÎã§","vi":"ƒëun n√≥ng, h√¢m n√≥ng"},
    {"kr":"Ìï¥ÎèôÌïòÎã§","vi":"r√£ ƒë√¥ng"},
    {"kr":"Í∞àÎã§","vi":"nghi·ªÅn, xay"},
    {"kr":"Ï∞ßÎã§","vi":"gi√£"},
    {"kr":"ÏûêÎ•¥Îã§","vi":"c·∫Øt"},
    {"kr":"Î∞òÏúºÎ°ú ÏûêÎ•¥Îã§","vi":"c·∫Øt l√†m ƒë√¥i"},
    {"kr":"ÎÑ§ Ï°∞Í∞ÅÏúºÎ°ú ÏûêÎ•¥Îã§","vi":"c·∫Øt l√†m t∆∞"},
    {"kr":"ÍπçÎëëÏç∞Í∏∞","vi":"c·∫Øt h·∫°t l·ª±u"},
    {"kr":"Ïç∞Îã§","vi":"th√°i"},
    {"kr":"Ï∞¢Îã§","vi":"x√©, b·ªï, t√°ch"},
    {"kr":"Îã§ÏßÄÎã§","vi":"bƒÉm nh·ªè"},
    {"kr":"Î≤óÍ∏∞Îã§","vi":"b√≥c, t√°ch, l·ªôt (l·ªõp v·ªè m·ªÅm b√™n ngo√†i)"},
    {"kr":"ÍπåÎã§","vi":"b√≥c, t√°ch, l·ªôt (l·ªõp v·ªè t∆∞∆°ng ƒë·ªëi c·ª©ng b√™n ngo√†i)"},
    {"kr":"ÏßúÎÇ¥Îã§","vi":"√©p, v·∫Øt n∆∞·ªõc"},
    {"kr":"Ï†ìÎã§","vi":"qu·∫•y, khu·∫•y"},
    {"kr":"ÎÑ£Îã§","vi":"cho v√†o, th√™m v√†o"},
    {"kr":"Îã¥Í∑∏Îã§","vi":"ng√¢m, mu·ªëi, ·ªß"},
    {"kr":"Î∞úÎùºÎÇ¥Îã§","vi":"g·ª°, r√≥c"},
    {"kr":"ÎºàÎ•º Î∞úÎùºÎÇ¥Îã§","vi":"r√∫t x∆∞∆°ng"},
    {"kr":"ÏåÄÏùÑ ÏîªÎã§","vi":"vo g·∫°o"},
    {"kr":"Í≥†Í∏∞Î•º Íº¨Ï±ôÏù¥Ïóê ÍΩÇÎã§","vi":"x√¢u th·ªãt v√†o xi√™n"},
    {"kr":"Íµ≠Ïóê ÎßõÏùÑ ÎÇ¥Îã§","vi":"n√™m gia v·ªã v√†o canh"}
  ],

  "T·ª´ v·ª±ng ti·∫øng H√†n v·ªÅ mi√™u t·∫£.docx4": [
    {"kr":"ÎßõÏûàÎã§","vi":"ngon"},
    {"kr":"ÎßõÏóÜÎã§","vi":"kh√¥ng ngon"},
    {"kr":"Îã¨Îã§","vi":"ng·ªçt"},
    {"kr":"ÏßúÎã§","vi":"m·∫∑n"},
    {"kr":"Ïß≠Ïß§ÌïòÎã§","vi":"h∆°i m·∫∑n"},
    {"kr":"ÏãúÎã§","vi":"chua"},
    {"kr":"ÎßµÎã§","vi":"cay"},
    {"kr":"Ïì∞Îã§","vi":"ƒë·∫Øng"},
    {"kr":"Ïã±Í≤ÅÎã§","vi":"nh·∫°t"},
    {"kr":"Ïã†ÏÑ†ÌïòÎã§","vi":"t∆∞∆°i"},
    {"kr":"Î∂ÄÎìúÎüΩÎã§","vi":"m·ªÅm"},
    {"kr":"ÎäêÎÅºÌïòÎã§","vi":"b√©o ng·∫≠y (nhi·ªÅu d·∫ßu m·ª°)"},
    {"kr":"Îã¥Î∞±ÌïòÎã§","vi":"thanh ƒë·∫°m"}
  ]
};

let currentGroup="__Builtin__";
let DATA = GROUPS[currentGroup];

// ====== IMG ======
const IMG={"ngon":"ü§§","kh√¥ng ngon":"üòñ","ng·ªçt":"üç¨","m·∫∑n":"üßÇ","h∆°i m·∫∑n":"üßÇ","chua":"üçã","cay":"üå∂Ô∏è","ƒë·∫Øng":"‚òï","nh·∫°t":"üíß","t∆∞∆°i":"ü•ó","m·ªÅm":"üßà","b√©o ng·∫≠y":"üßÄ","thanh ƒë·∫°m":"ü´ñ"};

// ====== STATE ======
let order=DATA.map((_,i)=>i);
let idx=0, score=0, mode='flash', langDir='kr2vi';
let countdown=60, timerId;
let selectedLeft=null; // for match
let mcqState=null; // persist options until correct

// ====== UTIL ======
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function isVI(text){return /[√†√°·∫£√£·∫°ƒÉ·∫±·∫Ø·∫≥·∫µ·∫∑√¢·∫ß·∫•·∫©·∫´·∫≠√™·ªÅ·∫ø·ªÉ·ªÖ·ªá√¨√≠·ªâƒ©·ªã√≤√≥·ªè√µ·ªç√¥·ªì·ªë·ªï·ªó·ªô∆°·ªù·ªõ·ªü·ª°·ª£√π√∫·ªß≈©·ª•∆∞·ª´·ª©·ª≠·ªØ·ª±·ª≥√Ω·ª∑·ªπ·ªµƒë]/i.test(text)}
function emojiForVI(text){if(!document.getElementById('imgToggle')?.checked) return ''; text=(text||'').toLowerCase(); let key=Object.keys(IMG).find(k=> text.includes(k)); return key? `<span class="img">${IMG[key]}</span>`:''}
function showCenter(msg){const ov=document.getElementById('centerOverlay'); const box=document.getElementById('centerBox'); box.textContent=msg; ov.style.display='flex'; setTimeout(()=>{ov.style.display='none'}, 900)}
function shuffleAll(){shuffle(order); idx=0; mcqState=null; render(); showCenter('ƒê√£ tr·ªôn b·ªô t·ª´!')}
function switchMode(m){document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));document.getElementById(m).classList.remove('hidden');mode=m; if(m==='match') setupMatch(true); if(m==='mcq') mcqState=null; render(); window.scrollTo({top:0, behavior:'smooth'});}
function resetGame(){langDir=document.getElementById('langDir').value;idx=0; mcqState=null; if(mode==='match') setupMatch(true); render()}
function currentPair(){return DATA[order[idx]]}
function render(){document.getElementById('score').textContent=score;document.getElementById('timer').textContent=countdown; if(mode==='flash') renderFlash(); if(mode==='mcq') renderMCQ(); if(mode==='match') renderMatch(); if(mode==='spell') renderSpell();}

// ====== NEW: Group handling ======
function populateGroupSelector(){
  const sel=document.getElementById('groupSelect');
  sel.innerHTML='';
  Object.keys(GROUPS).forEach(name=>{
    const opt=document.createElement('option'); opt.value=name; opt.textContent=name; sel.appendChild(opt);
  });
  sel.value=currentGroup;
}
function switchGroup(name){
  if(!GROUPS[name]) return;
  currentGroup=name; DATA=GROUPS[name];
  order = DATA.map((_,i)=>i); shuffle(order);
  idx=0; score=0; mcqState=null; selectedLeft=null;
  // reset n·ªëi c·∫∑p theo nh√≥m m·ªõi
  setupMatch(true);
  render(); showCenter('ƒê√£ chuy·ªÉn nh√≥m: '+name);
}

// ====== TOUCH SWIPE FOR FLASH ======
let touchStartX=null;
document.addEventListener('touchstart',e=>{touchStartX=e.changedTouches[0].screenX},{passive:true});
document.addEventListener('touchend',e=>{if(touchStartX==null) return; let dx=e.changedTouches[0].screenX - touchStartX; if(Math.abs(dx)>50){ idx=(idx + (dx<0?1:-1) + DATA.length)%DATA.length; renderFlash(); } touchStartX=null;},{passive:true});

// ====== FLASH ======
function renderFlash(){const p=currentPair(); const front= langDir==='kr2vi'? `${p.kr}` : `${p.vi}`; const back = langDir==='kr2vi'? `${emojiForVI(p.vi)} ${p.vi}` : p.kr; const f=document.getElementById('flashFront'); const b=document.getElementById('flashBack'); f.innerHTML=front; b.innerHTML='(ch·∫°m ƒë·ªÉ xem)'; const card=document.getElementById('flashCard'); card.onclick=()=>{b.innerHTML=back;};}

// ====== AUDIO + HAPTIC ======
let audioCtx=null;
function initAudio(){if(!audioCtx){try{audioCtx=new (window.AudioContext||window.webkitAudioContext)();}catch(e){audioCtx=null;}}}
function beep({freq=880,dur=120,type='sine',vol=0.1}={}){if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); setTimeout(()=>{o.stop()}, dur);}
function sfxCorrect(){beep({freq:1046,dur:120,type:'triangle',vol:0.08}); setTimeout(()=>beep({freq:1318,dur:120,type:'triangle',vol:0.08}),120)}
function sfxWrong(){beep({freq:220,dur:160,type:'sawtooth',vol:0.06})}
function vibrate(pattern){if(navigator.vibrate) navigator.vibrate(pattern)}
window.addEventListener('pointerdown',()=>{initAudio(); if(audioCtx?.state==='suspended') audioCtx.resume();},{once:true});

// ====== MCQ ======
function buildMCQState(){const i=order[idx]; const p=DATA[i]; const q = langDir==='kr2vi'? p.kr : p.vi; const answer = langDir==='kr2vi'? p.vi : p.kr; const pickWrong=(correctIndex,n=3)=>{const pool=[...Array(DATA.length).keys()].filter(k=>k!==correctIndex);shuffle(pool);return pool.slice(0,n)}; let opts=[answer,...pickWrong(i).map(j=> langDir==='kr2vi'? DATA[j].vi : DATA[j].kr)]; shuffle(opts); return {i, q, answer, opts, tried:new Set()}; }
function renderMCQ(){
  if(!mcqState || mcqState.i!==order[idx]) mcqState = buildMCQState();
  const {q, answer, opts} = mcqState;
  document.getElementById('mcqQ').textContent=q;
  const box=document.getElementById('mcqOptions'); box.innerHTML='';
  opts.forEach(opt=>{
    const div=document.createElement('div'); div.className='mcq-option';
    div.innerHTML=(isVI(opt)? emojiForVI(opt):'') + '<span>'+opt+'</span>';
    div.onclick=()=>{
      initAudio();
      box.classList.add('disable-pointer'); // kh√≥a t·∫°m khi ch·ªçn
      if(opt===answer){
        div.classList.add('correct'); score++; sfxCorrect(); vibrate([20,30,20]); showCenter('Th√πy Ch√¢m cutii gi·ªèi qu√° !!!');
        setTimeout(()=>{ idx=(idx+1)%DATA.length; mcqState=null; renderMCQ(); box.classList.remove('disable-pointer'); render(); },380);
      }else{
        div.classList.add('wrong'); sfxWrong(); vibrate([50,30,50]); document.getElementById('mcq').classList.add('shake');
        setTimeout(()=>document.getElementById('mcq').classList.remove('shake'),320);
        showCenter('Khum sao l√†m l·∫°i p√© ∆°i'); setTimeout(()=>box.classList.remove('disable-pointer'),320); render();
      }
    };
    box.appendChild(div);
  });
}

// ====== MATCH ======
// THAY ƒê·ªîI NH·∫∏: chia th√†nh nhi·ªÅu ƒë·ª£t 10 c·∫∑p, n·ªëi xong ƒë·ª£t n√†y s·∫Ω t·ª± hi·ªÉn th·ªã ƒë·ª£t k·∫ø ti·∫øp cho ƒë·∫øn h·∫øt
let matchPairs=[];      // c·∫∑p trong ƒë·ª£t hi·ªán t·∫°i (t·ªëi ƒëa 10)
let matchQueue=[];      // h√†ng ƒë·ª£i c√≤n l·∫°i (ch·ªâ s·ªë theo order)
let leftItems=[]; let rightItems=[];
/** kh·ªüi t·∫°o/ƒë·∫∑t l·∫°i ch·∫ø ƒë·ªô n·ªëi c·∫∑p.
 * @param {boolean} resetQueue - true: t·∫°o h√†ng ƒë·ª£i m·ªõi (khi v√†o mode, ƒë·ªïi nh√≥m, ƒë·ªïi chi·ªÅu)
 */
function setupMatch(resetQueue=false){
  selectedLeft=null;
  if(resetQueue || !matchQueue.length){
    // t·∫°o h√†ng ƒë·ª£i t·ª´ to√†n b·ªô ch·ªâ s·ªë c·ªßa b·ªô t·ª´ hi·ªán t·∫°i
    matchQueue = shuffle(order.slice(0));
  }
  loadNextMatchBatch();
}
function loadNextMatchBatch(){
  // l·∫•y t·ªëi ƒëa 10 ch·ªâ s·ªë ti·∫øp theo
  matchPairs = matchQueue.splice(0, Math.min(10, matchQueue.length));
  // n·∫øu kh√¥ng c√≤n g√¨ (tr∆∞·ªùng h·ª£p DATA < 1), gi·ªØ m·∫£ng r·ªóng ƒë·ªÉ render
  if(langDir==='kr2vi'){
    leftItems  = matchPairs.map(i=>({i, text: DATA[i].kr, isVI:false}));
    rightItems = shuffle(matchPairs.map(i=>({i, text: DATA[i].vi, isVI:true})));
  }else{
    leftItems  = matchPairs.map(i=>({i, text: DATA[i].vi, isVI:true}));
    rightItems = shuffle(matchPairs.map(i=>({i, text: DATA[i].kr, isVI:false})));
  }
}
function renderMatch(){
  const L=document.getElementById('matchLeft'); const R=document.getElementById('matchRight'); L.innerHTML=''; R.innerHTML='';
  leftItems.forEach((l,idxL)=>{
    const a=document.createElement('div'); a.className='tile'; a.innerHTML=(l.isVI? emojiForVI(l.text):'')+'<span>'+l.text+'</span>'; a.dataset.index=idxL;
    a.onclick=()=>{document.querySelectorAll('#matchLeft .tile').forEach(t=>t.classList.remove('selected')); a.classList.add('selected'); selectedLeft={i:l.i, el:a, idx: idxL};};
    L.appendChild(a)
  });
  rightItems.forEach((r,idxR)=>{
    const b=document.createElement('div'); b.className='tile'; b.innerHTML=(r.isVI? emojiForVI(r.text):'')+'<span>'+r.text+'</span>'; b.dataset.index=idxR;
    b.onclick=()=>{
      initAudio(); if(!selectedLeft) return; const left=selectedLeft;
      if(left.i===r.i){
        b.classList.add('correct'); left.el.classList.add('correct'); score++; sfxCorrect(); vibrate([20,30,20]); showCenter('Th√πy Ch√¢m cutii gi·ªèi qu√° !!!');
        setTimeout(()=>{
          leftItems.splice(left.idx,1); rightItems.splice(idxR,1); selectedLeft=null; 
          // n·∫øu ƒë√£ h·∫øt c·∫∑p trong ƒë·ª£t hi·ªán t·∫°i
          if(leftItems.length===0){
            if(matchQueue.length>0){
              // c√≤n c·∫∑p ti·∫øp theo: n·∫°p ƒë·ª£t m·ªõi v√† ti·∫øp t·ª•c
              loadNextMatchBatch();
              renderMatch();
              showCenter('Ti·∫øp t·ª•c ƒë·ª£t m·ªõi üëè');
            }else{
              // kh√¥ng c√≤n c·∫∑p n√†o: ho√†n t·∫•t to√†n b·ªô
              renderMatch();
              showCenter('Ho√†n th√†nh t·∫•t c·∫£ c·∫∑p! Tuy·ªát üëè');
            }
          }else{
            renderMatch();
          }
          render();
        },320);
      }else{
        b.classList.add('wrong'); left.el.classList.add('wrong'); sfxWrong(); vibrate([60,30,60]); document.getElementById('match').classList.add('shake');
        setTimeout(()=>{b.classList.remove('wrong'); left.el.classList.remove('wrong'); document.getElementById('match').classList.remove('shake');},380);
        showCenter('Khum sao l√†m l·∫°i p√© ∆°i');
      }
    };
    R.appendChild(b)
  });
}

// ====== SPELL ======
let spellAnswer='';
function renderSpell(){const p=currentPair(); const q= langDir==='kr2vi'? p.kr : p.vi; const ans = langDir==='kr2vi'? p.vi : p.kr; document.getElementById('spellQ').textContent=q; document.getElementById('spellTip').textContent='G·ª£i √Ω: '+(ans.length>2? ans[0]+'...' : ''); spellAnswer=ans; const inp=document.getElementById('spellIn'); inp.value=''; inp.focus();}
function checkSpell(){initAudio(); const val=document.getElementById('spellIn').value.trim(); if(!val) return; if(val.normalize('NFC').toLowerCase()===spellAnswer.normalize('NFC').toLowerCase()){score++; sfxCorrect(); vibrate([20,30,20]); showCenter('Th√πy Ch√¢m cutii gi·ªèi qu√° !!!'); idx=(idx+1)%DATA.length; renderSpell();} else {sfxWrong(); vibrate([60,30,60]); showCenter('Khum sao l√†m l·∫°i p√© ∆°i')} render();}

// ====== TIMER ======
function tick(){countdown--; document.getElementById('timer').textContent=countdown; if(countdown<=0){clearInterval(timerId); showCenter('‚è∞ H·∫øt gi·ªù! Nh·∫•n ‚Üª ƒë·ªÉ ch∆°i ti·∫øp');}}
function restartTimer(){clearInterval(timerId); countdown=60; timerId=setInterval(tick,1000); render();}

// ====== INIT ======
populateGroupSelector();
order = DATA.map((_,i)=>i);
shuffle(order);
// Kh·ªüi t·∫°o n·ªëi c·∫∑p v·ªõi h√†ng ƒë·ª£i to√†n b·ªô, hi·ªÉn th·ªã 10 c·∫∑p m·ªói ƒë·ª£t
setupMatch(true);
restartTimer();
render();
</script>
</body>
</html>
